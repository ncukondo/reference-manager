# reference-manager å®Ÿè£…ãƒ­ãƒ¼ãƒ‰ãƒãƒƒãƒ—

ç”Ÿæˆæ—¥: 2025-12-13 (æœ€çµ‚æ›´æ–°: 2025-12-16 - Phase 4.2 Aãƒ»B å®Œäº†)

## ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ¦‚è¦

**reference-manager (reference-manager)** ã¯ CSL-JSON ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å˜ä¸€ã®çœŸå®Ÿã®ã‚½ãƒ¼ã‚¹ã¨ã—ã¦æ‰±ã†ãƒ­ãƒ¼ã‚«ãƒ«å‚è€ƒæ–‡çŒ®ç®¡ç†ãƒ„ãƒ¼ãƒ«ã§ã™ã€‚

## å®Ÿè£…çŠ¶æ³ã‚µãƒãƒªãƒ¼

### âœ… å®Œäº†æ¸ˆã¿ (Completed)

- **ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—**
  - TypeScript + Vite ãƒ“ãƒ«ãƒ‰ç’°å¢ƒ
  - Vitest ãƒ†ã‚¹ãƒˆãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯
  - Biome (lint/format)
  - åŸºæœ¬çš„ãªãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹é€ 
  - ãƒ†ã‚¹ãƒˆãƒ•ã‚£ã‚¯ã‚¹ãƒãƒ£

- **Phase 1: ã‚³ã‚¢åŸºç›¤ - å®Œäº†** âœ…
  - CSL-JSONå‹å®šç¾© (`src/core/csl-json/types.ts`) âœ…
  - CSL-JSONãƒ‘ãƒ¼ã‚µãƒ¼ (`src/core/csl-json/parser.ts`) âœ…
  - CSL-JSONã‚·ãƒªã‚¢ãƒ©ã‚¤ã‚¶ãƒ¼ (`src/core/csl-json/serializer.ts`) âœ…
  - CSL-JSONãƒãƒªãƒ‡ãƒ¼ã‚¿ãƒ¼ (`src/core/csl-json/validator.ts`) âœ…
  - UUIDç®¡ç† (`src/core/identifier/uuid.ts`) âœ…
  - ãƒ†ã‚­ã‚¹ãƒˆæ­£è¦åŒ– (`src/core/identifier/normalize.ts`) âœ…
  - IDç”Ÿæˆ (`src/core/identifier/generator.ts`) âœ…
  - å‚è€ƒæ–‡çŒ®ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ (`src/core/reference.ts`) âœ…
  - ãƒ©ã‚¤ãƒ–ãƒ©ãƒªç®¡ç† (`src/core/library.ts`) âœ…
  - ã‚³ã‚¢ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ (`src/core/index.ts`) âœ…
  - **å…¨ãƒ†ã‚¹ãƒˆ**: 140ãƒ†ã‚¹ãƒˆåˆæ ¼ âœ…

- **Phase 2: ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ã¨è¨­å®š - å®Œäº†** âœ…
  - Phase 2.1: ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«
    - ãƒ­ã‚¬ãƒ¼ (`src/utils/logger.ts`) âœ…
    - ãƒãƒƒã‚·ãƒ¥ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ (`src/utils/hash.ts`) âœ…
    - ãƒ•ã‚¡ã‚¤ãƒ«ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ (`src/utils/file.ts`) âœ…
    - ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ç®¡ç† (`src/utils/backup.ts`) âœ…
    - ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ (`src/utils/index.ts`) âœ…
  - Phase 2.2: è¨­å®šç®¡ç†
    - è¨­å®šã‚¹ã‚­ãƒ¼ãƒ (`src/config/schema.ts`) âœ…
    - è¨­å®šãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ (`src/config/defaults.ts`) âœ…
    - è¨­å®šãƒ­ãƒ¼ãƒ€ãƒ¼ (`src/config/loader.ts`) âœ…
    - è¨­å®šã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ (`src/config/index.ts`) âœ…
  - **å…¨ãƒ†ã‚¹ãƒˆ**: 77ãƒ†ã‚¹ãƒˆåˆæ ¼ âœ…

- **Phase 3: æ©Ÿèƒ½ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ« - å®Œäº†** âœ…
  - Phase 3.1: æ¤œç´¢æ©Ÿèƒ½ - å®Œäº† (2025-12-14)
    - Tokenizer (ã‚¯ã‚¨ãƒªãƒˆãƒ¼ã‚¯ãƒ³åŒ–) - 26ãƒ†ã‚¹ãƒˆåˆæ ¼ âœ…
    - Normalizer (ãƒ†ã‚­ã‚¹ãƒˆæ­£è¦åŒ–) - 22ãƒ†ã‚¹ãƒˆåˆæ ¼ âœ…
    - Matcher (ãƒãƒƒãƒãƒ³ã‚°ã€searché–¢æ•°) - 31ãƒ†ã‚¹ãƒˆåˆæ ¼ âœ…
    - Sorter (çµæœã‚½ãƒ¼ãƒˆ) - 16ãƒ†ã‚¹ãƒˆåˆæ ¼ âœ…
  - **Phase 3.1 å…¨ãƒ†ã‚¹ãƒˆ**: 95ãƒ†ã‚¹ãƒˆåˆæ ¼ âœ…
  - Phase 3.2: é‡è¤‡æ¤œå‡º - å®Œäº† (2025-12-14)
    - Detector (é‡è¤‡æ¤œå‡ºãƒ­ã‚¸ãƒƒã‚¯) - 24ãƒ†ã‚¹ãƒˆåˆæ ¼ âœ…
  - **Phase 3.2 å…¨ãƒ†ã‚¹ãƒˆ**: 24ãƒ†ã‚¹ãƒˆåˆæ ¼ âœ…
  - Phase 3.3: 3-wayãƒãƒ¼ã‚¸ - å®Œäº† (2025-12-15)
    - Three-way Merge (LWWå¯¾å¿œãƒãƒ¼ã‚¸ãƒ­ã‚¸ãƒƒã‚¯) - 21ãƒ†ã‚¹ãƒˆåˆæ ¼ âœ…
  - **Phase 3.3 å…¨ãƒ†ã‚¹ãƒˆ**: 21ãƒ†ã‚¹ãƒˆåˆæ ¼ âœ…
  - Phase 3.4: ãƒ•ã‚¡ã‚¤ãƒ«ç›£è¦– - å®Œäº† (2025-12-15)
    - FileWatcher (chokidarãƒ™ãƒ¼ã‚¹ç›£è¦–ã€debounceã€ãƒªãƒˆãƒ©ã‚¤) - 26ãƒ†ã‚¹ãƒˆåˆæ ¼ âœ…
  - **Phase 3.4 å…¨ãƒ†ã‚¹ãƒˆ**: 26ãƒ†ã‚¹ãƒˆåˆæ ¼ âœ…

- **Phase 4.1: HTTPã‚µãƒ¼ãƒãƒ¼ - å®Œäº†** âœ… (2025-12-15)
  - Portfileç®¡ç† (`src/server/portfile.ts`) - 16ãƒ†ã‚¹ãƒˆåˆæ ¼ âœ…
  - Health Route (`src/server/routes/health.ts`) - 4ãƒ†ã‚¹ãƒˆåˆæ ¼ âœ…
  - References Route (`src/server/routes/references.ts`) - 10ãƒ†ã‚¹ãƒˆåˆæ ¼ âœ…
  - Server Entry (`src/server/index.ts`) - 3ãƒ†ã‚¹ãƒˆåˆæ ¼ âœ…
  - Validatoræ‹¡å¼µ (`validateCslItem` è¿½åŠ ) âœ…
  - **Phase 4.1 å…¨ãƒ†ã‚¹ãƒˆ**: 33ãƒ†ã‚¹ãƒˆåˆæ ¼ âœ…

- **Phase 4.2: CLI - Phase Aãƒ»Bãƒ»C å®Œäº†** ğŸŸ  (2025-12-16)
  - Phase A: åŸºç›¤æ‹¡å¼µ - 67ãƒ†ã‚¹ãƒˆåˆæ ¼ âœ…
    - Config Schema (`src/config/schema.ts`) - serverè¨­å®šè¿½åŠ  âœ…
    - Config Defaults (`src/config/defaults.ts`) - serverãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤è¿½åŠ  âœ…
    - Portfile (`src/server/portfile.ts`) - library/started_atè¿½åŠ  âœ…
    - Library Hash (`src/core/library.ts`) - ãƒ•ã‚¡ã‚¤ãƒ«ãƒãƒƒã‚·ãƒ¥è¿½è·¡ âœ…
  - Phase B: å‡ºåŠ›ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ« - 53ãƒ†ã‚¹ãƒˆåˆæ ¼ âœ…
    - JSON Output (`src/cli/output/json.ts`) - 9ãƒ†ã‚¹ãƒˆåˆæ ¼ âœ…
    - Pretty Output (`src/cli/output/pretty.ts`) - 19ãƒ†ã‚¹ãƒˆåˆæ ¼ âœ…
    - BibTeX Output (`src/cli/output/bibtex.ts`) - 25ãƒ†ã‚¹ãƒˆåˆæ ¼ âœ…
    - Output Index (`src/cli/output/index.ts`) - ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ âœ…
  - **Phase 4.2 Aãƒ»Bãƒ»C å…¨ãƒ†ã‚¹ãƒˆ**: 141ãƒ†ã‚¹ãƒˆåˆæ ¼ âœ…

### ğŸš§ æœªå®Ÿè£… (Not Yet Implemented)

ä»¥ä¸‹ã®é …ç›®ã¯specå®šç¾©æ¸ˆã¿ã§ã™ãŒã€ã‚³ãƒ¼ãƒ‰ã¯æœªå®Ÿè£…ã§ã™ã€‚

---

## å®Ÿè£…ãƒ­ãƒ¼ãƒ‰ãƒãƒƒãƒ—

å®Ÿè£…ã¯ä»¥ä¸‹ã®5ã¤ã®ãƒ•ã‚§ãƒ¼ã‚ºã«åˆ†ã‘ã¦é€²ã‚ã¾ã™ã€‚

### Phase 1: ã‚³ã‚¢åŸºç›¤ (Core Foundation) âœ… å®Œäº† (2025-12-12)

#### 1.1 CSL-JSONå‡¦ç†ã®å®Œæˆ âœ…

**ç›®æ¨™**: CSL-JSONã®èª­ã¿æ›¸ããƒ»ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å®Œå…¨ã«å®Ÿè£…

| ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ | ãƒ•ã‚¡ã‚¤ãƒ« | çŠ¶æ…‹ | èª¬æ˜ |
|--------------|---------|------|------|
| Serializer | `src/core/csl-json/serializer.ts` | âœ… å®Œäº† | CSL-JSONã¸ã®ã‚·ãƒªã‚¢ãƒ©ã‚¤ã‚º |
| Serializer Test | `src/core/csl-json/serializer.test.ts` | âœ… å®Œäº† | ã‚·ãƒªã‚¢ãƒ©ã‚¤ã‚¶ãƒ¼ã®ãƒ†ã‚¹ãƒˆ (11ãƒ†ã‚¹ãƒˆ) |
| Validator | `src/core/csl-json/validator.ts` | âœ… å®Œäº† | æ›¸ãè¾¼ã¿å‰ã®ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ |
| Validator Test | `src/core/csl-json/validator.test.ts` | âœ… å®Œäº† | ãƒãƒªãƒ‡ãƒ¼ã‚¿ãƒ¼ã®ãƒ†ã‚¹ãƒˆ (15ãƒ†ã‚¹ãƒˆ) |

**å®Ÿè£…å®Œäº†**: 2025-12-12

**å®Ÿè£…å†…å®¹**:
1. âœ… `serializer.ts` - JSON.stringifyã€2ã‚¹ãƒšãƒ¼ã‚¹ã‚¤ãƒ³ãƒ‡ãƒ³ãƒˆã€è¦ªãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªä½œæˆ
2. âœ… `serializer.test.ts` - ãƒ©ã‚¦ãƒ³ãƒ‰ãƒˆãƒªãƒƒãƒ—ãƒ†ã‚¹ãƒˆã€ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆæ¤œè¨¼
3. âœ… `validator.ts` - Zodã‚¹ã‚­ãƒ¼ãƒã«ã‚ˆã‚‹æ§‹é€ æ¤œè¨¼ã€ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
4. âœ… `validator.test.ts` - ä¸æ­£ãƒ‡ãƒ¼ã‚¿ã€å¿…é ˆãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã€ã‚¨ãƒƒã‚¸ã‚±ãƒ¼ã‚¹ã®æ¤œè¨¼
5. âœ… `tests/fixtures/invalid.json` - ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ãƒ†ã‚¹ãƒˆç”¨ãƒ•ã‚£ã‚¯ã‚¹ãƒãƒ£

**ãƒ†ã‚¹ãƒˆçµæœ**: å…¨39ãƒ†ã‚¹ãƒˆåˆæ ¼ (parser: 13, serializer: 11, validator: 15)

#### 1.2 è­˜åˆ¥å­ç”Ÿæˆ âœ…

**ç›®æ¨™**: BibTeXå½¢å¼ã®IDç”Ÿæˆã¨UUIDç®¡ç†

| ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ | ãƒ•ã‚¡ã‚¤ãƒ« | çŠ¶æ…‹ | èª¬æ˜ |
|--------------|---------|------|------|
| ID Generator | `src/core/identifier/generator.ts` | âœ… å®Œäº† | `<Author>-<Year>[-<TitleSlug>]` å½¢å¼ã®IDç”Ÿæˆ |
| Generator Test | `src/core/identifier/generator.test.ts` | âœ… å®Œäº† | IDç”Ÿæˆãƒ­ã‚¸ãƒƒã‚¯ã®ãƒ†ã‚¹ãƒˆ (22ãƒ†ã‚¹ãƒˆ) |
| Normalizer | `src/core/identifier/normalize.ts` | âœ… å®Œäº† | ãƒ†ã‚­ã‚¹ãƒˆæ­£è¦åŒ– (ã‚¹ãƒšãƒ¼ã‚¹â†’_ã€ASCIIåŒ–) |
| Normalizer Test | `src/core/identifier/normalize.test.ts` | âœ… å®Œäº† | æ­£è¦åŒ–ã®ãƒ†ã‚¹ãƒˆ (28ãƒ†ã‚¹ãƒˆ) |
| UUID Test | `src/core/identifier/uuid.test.ts` | âŒ æœªå®Ÿè£… | UUIDç®¡ç†ã®ãƒ†ã‚¹ãƒˆ |
| Types | `src/core/identifier/types.ts` | âŒ æœªå®Ÿè£… | è­˜åˆ¥å­é–¢é€£ã®å‹å®šç¾© |

**å®Ÿè£…ä»•æ§˜**: `spec/core/identifier-generation.md`

**å®Ÿè£…å®Œäº†**: 2025-12-12

**å®Ÿè£…å†…å®¹**:
1. âœ… `normalize.ts` - ã‚¹ãƒšãƒ¼ã‚¹ã‚’ã‚¢ãƒ³ãƒ€ãƒ¼ã‚¹ã‚³ã‚¢ã«å¤‰æ›ã€ASCIIæ–‡å­—ãƒ»æ•°å­—ãƒ»_ã®ã¿ä¿æŒ
2. âœ… `normalize.test.ts` - 28ãƒ†ã‚¹ãƒˆ (å¤šè¨€èªã€ç‰¹æ®Šæ–‡å­—ã€ã‚¨ãƒƒã‚¸ã‚±ãƒ¼ã‚¹)
3. âœ… `generator.ts` - IDç”Ÿæˆãƒ­ã‚¸ãƒƒã‚¯ã€ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ (anon/nd/untitled)ã€è¡çªå‡¦ç† (a-z, aa-zz...)
4. âœ… `generator.test.ts` - 22ãƒ†ã‚¹ãƒˆ (è‘—è€…/å¹´/ã‚¿ã‚¤ãƒˆãƒ«ã®çµ„ã¿åˆã‚ã›ã€è¡çªå‡¦ç†)
5. â³ `uuid.test.ts` - æœªå®Ÿè£… (UUIDæ©Ÿèƒ½è‡ªä½“ã¯æ—¢å­˜)
6. â³ `types.ts` - æœªå®Ÿè£… (å¿…è¦ã«å¿œã˜ã¦è¿½åŠ )

**ãƒ†ã‚¹ãƒˆçµæœ**: å…¨50ãƒ†ã‚¹ãƒˆåˆæ ¼ (normalize: 28, generator: 22)

#### 1.3 ã‚³ã‚¢ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ âœ…

**ç›®æ¨™**: å‚è€ƒæ–‡çŒ®ã¨ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£å®Ÿè£…

| ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ | ãƒ•ã‚¡ã‚¤ãƒ« | çŠ¶æ…‹ | èª¬æ˜ |
|--------------|---------|------|------|
| Reference Entity | `src/core/reference.ts` | âœ… å®Œäº† | å‚è€ƒæ–‡çŒ®ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ |
| Reference Test | `src/core/reference.test.ts` | âœ… å®Œäº† | å‚è€ƒæ–‡çŒ®ã®ãƒ†ã‚¹ãƒˆ (25ãƒ†ã‚¹ãƒˆ) |
| Library Manager | `src/core/library.ts` | âœ… å®Œäº† | ãƒ©ã‚¤ãƒ–ãƒ©ãƒªç®¡ç†ã‚¯ãƒ©ã‚¹ |
| Library Test | `src/core/library.test.ts` | âœ… å®Œäº† | ãƒ©ã‚¤ãƒ–ãƒ©ãƒªç®¡ç†ã®ãƒ†ã‚¹ãƒˆ (26ãƒ†ã‚¹ãƒˆ) |
| Core Index | `src/core/index.ts` | âœ… å®Œäº† | ã‚³ã‚¢ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ |

**å®Ÿè£…ä»•æ§˜**: `spec/core/data-model.md`

**å®Ÿè£…å®Œäº†**: 2025-12-12

**å®Ÿè£…å†…å®¹**:
1. âœ… `reference.test.ts` - å‚è€ƒæ–‡çŒ®ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã®ãƒ†ã‚¹ãƒˆ (TDD: ãƒ†ã‚¹ãƒˆå…ˆè¡Œ)
2. âœ… `reference.ts` - UUIDè‡ªå‹•ç”Ÿæˆã€IDç”Ÿæˆçµ±åˆã€ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã‚¢ã‚¯ã‚»ã‚¹
3. âœ… `library.test.ts` - ãƒ©ã‚¤ãƒ–ãƒ©ãƒªç®¡ç†ã®ãƒ†ã‚¹ãƒˆ (TDD: ãƒ†ã‚¹ãƒˆå…ˆè¡Œ)
4. âœ… `library.ts` - ãƒ•ã‚¡ã‚¤ãƒ«I/Oã€ã‚¤ãƒ³ãƒ¡ãƒ¢ãƒªã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ (UUID/ID/DOI/PMID)ã€CRUDæ“ä½œ
5. âœ… `index.ts` - ã‚³ã‚¢ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã®çµ±åˆã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ

**ãƒ†ã‚¹ãƒˆçµæœ**: å…¨51ãƒ†ã‚¹ãƒˆåˆæ ¼ (reference: 25, library: 26)

**Phase 1 å®Œäº†æ¡ä»¶**:
- âœ… CSL-JSONã®èª­ã¿æ›¸ããŒå®Œå…¨ã«å‹•ä½œ
- âœ… IDç”ŸæˆãŒä»•æ§˜é€šã‚Šã«å‹•ä½œ (è¡çªå‡¦ç†å«ã‚€)
- âœ… ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®åŸºæœ¬æ“ä½œ (è¿½åŠ ãƒ»å‰Šé™¤ãƒ»èª­ã¿è¾¼ã¿) ãŒå‹•ä½œ

---

### Phase 2: ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ã¨è¨­å®š (Utils & Config) ğŸŸ  å„ªå…ˆåº¦: ä¸­

#### 2.1 ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ« âœ…

**ç›®æ¨™**: ãƒ•ã‚¡ã‚¤ãƒ«æ“ä½œã€ãƒ­ã‚®ãƒ³ã‚°ã€ãƒãƒƒã‚·ãƒ¥ã€ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—

| ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ | ãƒ•ã‚¡ã‚¤ãƒ« | çŠ¶æ…‹ | èª¬æ˜ |
|--------------|---------|------|------|
| Logger | `src/utils/logger.ts` | âœ… å®Œäº† | ãƒ­ã‚®ãƒ³ã‚° (stdout/stderråˆ†é›¢) |
| Logger Test | `src/utils/logger.test.ts` | âœ… å®Œäº† | ãƒ­ã‚¬ãƒ¼ã®ãƒ†ã‚¹ãƒˆ (16ãƒ†ã‚¹ãƒˆ) |
| File Utils | `src/utils/file.ts` | âœ… å®Œäº† | ãƒ•ã‚¡ã‚¤ãƒ«æ“ä½œ (atomic writeå«ã‚€) |
| File Test | `src/utils/file.test.ts` | âœ… å®Œäº† | ãƒ•ã‚¡ã‚¤ãƒ«ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ã®ãƒ†ã‚¹ãƒˆ (14ãƒ†ã‚¹ãƒˆ) |
| Hash Utils | `src/utils/hash.ts` | âœ… å®Œäº† | SHA-256ãƒãƒƒã‚·ãƒ¥è¨ˆç®— |
| Hash Test | `src/utils/hash.test.ts` | âœ… å®Œäº† | ãƒãƒƒã‚·ãƒ¥ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ã®ãƒ†ã‚¹ãƒˆ (14ãƒ†ã‚¹ãƒˆ) |
| Backup Utils | `src/utils/backup.ts` | âœ… å®Œäº† | ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ç®¡ç† (ä¸–ä»£ãƒ»æœŸé™ç®¡ç†) |
| Backup Test | `src/utils/backup.test.ts` | âœ… å®Œäº† | ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ç®¡ç†ã®ãƒ†ã‚¹ãƒˆ (16ãƒ†ã‚¹ãƒˆ) |
| Utils Index | `src/utils/index.ts` | âœ… å®Œäº† | ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ |

**å®Ÿè£…ä»•æ§˜**:
- `spec/features/write-safety.md` - ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã€ãƒãƒƒã‚·ãƒ¥
- `spec/architecture/cli.md` - ãƒ­ã‚®ãƒ³ã‚°

**å®Ÿè£…å®Œäº†**: 2025-12-13

**å®Ÿè£…å†…å®¹**:
1. âœ… `logger.ts` - ãƒ­ã‚°ãƒ¬ãƒ™ãƒ« (debug/info/error)ã€stderr/stdoutåˆ†é›¢ã€ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—ä»˜ããƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ
2. âœ… `logger.test.ts` - 16ãƒ†ã‚¹ãƒˆ (ãƒ­ã‚°ãƒ¬ãƒ™ãƒ«ã€å‡ºåŠ›å…ˆã€ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆæ¤œè¨¼)
3. âœ… `hash.ts` - SHA-256è¨ˆç®— (æ–‡å­—åˆ—ãƒ»ãƒ•ã‚¡ã‚¤ãƒ«)
4. âœ… `hash.test.ts` - 14ãƒ†ã‚¹ãƒˆ (ãƒãƒƒã‚·ãƒ¥è¨ˆç®—ã€ãƒ•ã‚¡ã‚¤ãƒ«ãƒãƒƒã‚·ãƒ¥æ¤œè¨¼)
5. âœ… `file.ts` - atomic write (write-file-atomicä½¿ç”¨)ã€ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªä½œæˆ
6. âœ… `file.test.ts` - 14ãƒ†ã‚¹ãƒˆ (atomic writeã€ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªä½œæˆã€ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°)
7. âœ… `backup.ts` - ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªç®¡ç†ã€ä¸–ä»£ç®¡ç†ã€æœŸé™ç®¡ç†
8. âœ… `backup.test.ts` - 16ãƒ†ã‚¹ãƒˆ (ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ä½œæˆã€ä¸€è¦§ã€ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—)
9. âœ… `index.ts` - ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã®çµ±åˆã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ

**ãƒ†ã‚¹ãƒˆçµæœ**: å…¨60ãƒ†ã‚¹ãƒˆåˆæ ¼ (logger: 16, hash: 14, file: 14, backup: 16)

#### 2.2 è¨­å®šç®¡ç† âœ…

**ç›®æ¨™**: TOMLè¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã®èª­ã¿è¾¼ã¿ã¨è§£æ±º

| ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ | ãƒ•ã‚¡ã‚¤ãƒ« | çŠ¶æ…‹ | èª¬æ˜ |
|--------------|---------|------|------|
| Config Schema | `src/config/schema.ts` | âœ… å®Œäº† | Zodã‚¹ã‚­ãƒ¼ãƒãƒ»å‹å®šç¾©ãƒ»æ­£è¦åŒ– |
| Config Defaults | `src/config/defaults.ts` | âœ… å®Œäº† | ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ãƒ»ãƒ‘ã‚¹å–å¾—é–¢æ•° |
| Config Loader Test | `src/config/loader.test.ts` | âœ… å®Œäº† | è¨­å®šãƒ­ãƒ¼ãƒ€ãƒ¼ã®ãƒ†ã‚¹ãƒˆ (17ãƒ†ã‚¹ãƒˆ) |
| Config Loader | `src/config/loader.ts` | âœ… å®Œäº† | TOMLèª­ã¿è¾¼ã¿ãƒ»è§£æ±ºãƒ»ãƒãƒ¼ã‚¸ |
| Config Index | `src/config/index.ts` | âœ… å®Œäº† | è¨­å®šãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ |

**å®Ÿè£…ä»•æ§˜**: `spec/architecture/cli.md` - è¨­å®šè§£æ±ºé †åºãƒ»ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ

**å®Ÿè£…å®Œäº†**: 2025-12-13

**è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«**:
- ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ: **TOML** (`@iarna/toml`)
- ã‚«ãƒ¬ãƒ³ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª: `.reference-manager.config.toml` (æœ€å„ªå…ˆ)
- ç’°å¢ƒå¤‰æ•°: `REFERENCE_MANAGER_CONFIG`
- ãƒ¦ãƒ¼ã‚¶ãƒ¼è¨­å®š: `~/.reference-manager/config.toml` (æœ€ä½å„ªå…ˆ)

**è¨­å®šé …ç›®**:
- `library`: CSL-JSONãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¹ (ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: `~/.reference-manager/csl.library.json`)
- `log_level`: ãƒ­ã‚°ãƒ¬ãƒ™ãƒ« (`silent` | `info` | `debug`)
- `backup.*`: ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—è¨­å®š (ä¸–ä»£æ•°ã€ä¿å­˜æœŸé–“ã€ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª)
- `watch.*`: ãƒ•ã‚¡ã‚¤ãƒ«ç›£è¦–è¨­å®š (debounceã€pollingã€retry)

**å®Ÿè£…å†…å®¹**:
1. âœ… `schema.ts` - Zodã‚¹ã‚­ãƒ¼ãƒã€LogLevel/BackupConfig/WatchConfig/Configå‹ã€DeepPartialConfigå‹ã€snake_caseâ†’camelCaseæ­£è¦åŒ–
2. âœ… `defaults.ts` - ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆè¨­å®šå€¤ã€ãƒ‘ã‚¹å–å¾—é–¢æ•° (getDefaultLibraryPathç­‰)
3. âœ… `loader.test.ts` - 17ãƒ†ã‚¹ãƒˆ (TDD: ãƒ†ã‚¹ãƒˆå…ˆè¡Œ) - ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã€ãƒ•ã‚¡ã‚¤ãƒ«èª­ã¿è¾¼ã¿ã€å„ªå…ˆé †ä½ã€ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã€CLIä¸Šæ›¸ã
4. âœ… `loader.ts` - TOMLèª­ã¿è¾¼ã¿ã€è¨­å®šè§£æ±º (ã‚«ãƒ¬ãƒ³ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª > ç’°å¢ƒå¤‰æ•° > ãƒ¦ãƒ¼ã‚¶ãƒ¼è¨­å®š > ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ)ã€ãƒãƒ¼ã‚¸ã€ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
5. âœ… `index.ts` - å‹ãƒ»ã‚¹ã‚­ãƒ¼ãƒãƒ»é–¢æ•°ã®ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ

**ãƒ†ã‚¹ãƒˆçµæœ**: å…¨17ãƒ†ã‚¹ãƒˆåˆæ ¼ (loader: 17ãƒ†ã‚¹ãƒˆ)

**Phase 2.1 å®Œäº†æ¡ä»¶**:
- âœ… ãƒ­ã‚®ãƒ³ã‚°ãŒå‹•ä½œ
- âœ… ãƒ•ã‚¡ã‚¤ãƒ«ã®atomic writeãŒå‹•ä½œ
- âœ… ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ç”Ÿæˆãƒ»ä¸–ä»£ç®¡ç†ãŒå‹•ä½œ

**Phase 2.2 å®Œäº†æ¡ä»¶**:
- âœ… TOMLè¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã®èª­ã¿è¾¼ã¿ãŒå‹•ä½œ
- âœ… è¨­å®šè§£æ±ºé †åº (ã‚«ãƒ¬ãƒ³ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª > ç’°å¢ƒå¤‰æ•° > ãƒ¦ãƒ¼ã‚¶ãƒ¼è¨­å®š) ãŒå‹•ä½œ
- âœ… ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã®ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ãŒå‹•ä½œ
- âœ… CLIå¼•æ•°ã«ã‚ˆã‚‹è¨­å®šä¸Šæ›¸ãã®æº–å‚™ãŒå®Œäº†

---

### Phase 3: æ©Ÿèƒ½ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ« (Features) ğŸŸ¡ å„ªå…ˆåº¦: ä¸­

#### 3.1 æ¤œç´¢æ©Ÿèƒ½ âœ… å®Œäº† (2025-12-14)

**ç›®æ¨™**: ã‚¯ã‚¨ãƒªå‡¦ç†ã€ãƒ†ã‚­ã‚¹ãƒˆæ­£è¦åŒ–ã€ãƒãƒƒãƒãƒ³ã‚°ã€ã‚½ãƒ¼ãƒˆ

| ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ | ãƒ•ã‚¡ã‚¤ãƒ« | çŠ¶æ…‹ | èª¬æ˜ |
|--------------|---------|------|------|
| Search Types | `src/features/search/types.ts` | âœ… å®Œäº† | æ¤œç´¢é–¢é€£ã®å‹å®šç¾© (ã‚¯ã‚¨ãƒªã€ãƒˆãƒ¼ã‚¯ãƒ³ã€çµæœ) |
| Tokenizer Test | `src/features/search/tokenizer.test.ts` | âœ… å®Œäº† | ãƒˆãƒ¼ã‚¯ãƒ³åŒ–ã®ãƒ†ã‚¹ãƒˆ (26ãƒ†ã‚¹ãƒˆåˆæ ¼) |
| Tokenizer | `src/features/search/tokenizer.ts` | âœ… å®Œäº† | ã‚¯ã‚¨ãƒªã®ãƒˆãƒ¼ã‚¯ãƒ³åŒ–ã€å¼•ç”¨ç¬¦å‡¦ç†ã€ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰æŒ‡å®šè§£æ |
| Normalizer Test | `src/features/search/normalizer.test.ts` | âœ… å®Œäº† | æ­£è¦åŒ–ã®ãƒ†ã‚¹ãƒˆ (22ãƒ†ã‚¹ãƒˆåˆæ ¼) |
| Normalizer | `src/features/search/normalizer.ts` | âœ… å®Œäº† | NFKCã€å°æ–‡å­—åŒ–ã€è¨˜å·é™¤å» |
| Search Index | `src/features/search/index.ts` | âœ… å®Œäº† | æ¤œç´¢æ©Ÿèƒ½ã®ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ |
| Matcher Test | `src/features/search/matcher.test.ts` | âœ… å®Œäº† | ãƒãƒƒãƒãƒ³ã‚°ã®ãƒ†ã‚¹ãƒˆ (31ãƒ†ã‚¹ãƒˆåˆæ ¼) |
| Matcher | `src/features/search/matcher.ts` | âœ… å®Œäº† | IDç³»å®Œå…¨ä¸€è‡´ã€ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ç³»éƒ¨åˆ†ä¸€è‡´ã€ANDæ¤œç´¢ãƒ­ã‚¸ãƒƒã‚¯ã€searché–¢æ•° |
| Sorter Test | `src/features/search/sorter.test.ts` | âœ… å®Œäº† | ã‚½ãƒ¼ãƒˆã®ãƒ†ã‚¹ãƒˆ (16ãƒ†ã‚¹ãƒˆåˆæ ¼) |
| Sorter | `src/features/search/sorter.ts` | âœ… å®Œäº† | ãƒãƒƒãƒå¼·åº¦ãƒ»å¹´ãƒ»è‘—è€…ãƒ»ã‚¿ã‚¤ãƒˆãƒ«ãƒ»ç™»éŒ²é †ã‚½ãƒ¼ãƒˆ |

**å®Ÿè£…ä»•æ§˜**: `spec/features/search.md`

**æ¤œç´¢ä»•æ§˜ã®è¦ç‚¹**:
- **ã‚¯ã‚¨ãƒªå‡¦ç†**: ã‚¹ãƒšãƒ¼ã‚¹åŒºåˆ‡ã‚Šãƒˆãƒ¼ã‚¯ãƒ³åŒ–ã€å¼•ç”¨ç¬¦ã§ãƒ•ãƒ¬ãƒ¼ã‚ºæ¤œç´¢ã€ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰æŒ‡å®šæ¤œç´¢ (`author:`, `doi:`, `pmid:`, etc.)
- **æ¤œç´¢ãƒ­ã‚¸ãƒƒã‚¯**: ANDæ¤œç´¢ï¼ˆã™ã¹ã¦ã®ãƒˆãƒ¼ã‚¯ãƒ³ãŒãƒãƒƒãƒå¿…è¦ï¼‰
- **ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰åˆ†é¡**:
  - IDç³» (PMID, PMCID, DOI, URL, additional_urls): å®Œå…¨ä¸€è‡´ã€å¤§æ–‡å­—å°æ–‡å­—åŒºåˆ¥
  - ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ç³» (title, author, keywordç­‰): éƒ¨åˆ†ä¸€è‡´ã€å¤§æ–‡å­—å°æ–‡å­—åŒä¸€è¦–
- **æ­£è¦åŒ–**: Unicode NFKCã€å°æ–‡å­—åŒ–ã€è¨˜å·å‰Šé™¤ã€ç©ºç™½æ­£è¦åŒ–
- **ã‚½ãƒ¼ãƒˆ**: ãƒãƒƒãƒå¼·åº¦ â†’ å¹´ â†’ è‘—è€… â†’ ã‚¿ã‚¤ãƒˆãƒ« â†’ ç™»éŒ²é †
- **å‡ºåŠ›**: `--json`, `--ids-only`, `--uuid`, `--bibtex`

**å®Ÿè£…å®Œäº†**: 2025-12-14

**å®Ÿè£…å†…å®¹**:
1. âœ… `types.ts` - SearchToken, SearchQuery, MatchStrength, SearchResultç­‰ã®å‹å®šç¾©ã€CslItemå‹ã«çµ±ä¸€
2. âœ… `tokenizer.test.ts` - 26ãƒ†ã‚¹ãƒˆå®Ÿè£… (åŸºæœ¬ãƒˆãƒ¼ã‚¯ãƒ³åŒ–ã€ãƒ•ãƒ¬ãƒ¼ã‚ºæ¤œç´¢ã€ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰æŒ‡å®š)
3. âœ… `tokenizer.ts` - ã‚¹ãƒšãƒ¼ã‚¹åŒºåˆ‡ã‚Šã€å¼•ç”¨ç¬¦å‡¦ç†ã€field:valueè§£æã€å‹ã‚¨ãƒ©ãƒ¼ä¿®æ­£
4. âœ… `normalizer.test.ts` - 22ãƒ†ã‚¹ãƒˆå®Ÿè£… (Unicode NFKCã€å°æ–‡å­—åŒ–ã€è¨˜å·å‰Šé™¤ã€ã‚¨ãƒƒã‚¸ã‚±ãƒ¼ã‚¹)
5. âœ… `normalizer.ts` - NFKCæ­£è¦åŒ–ã€NFDåˆ†è§£ã€ç™ºéŸ³è¨˜å·é™¤å»ã€ç©ºç™½æ­£è¦åŒ–å®Ÿè£…
6. âœ… `index.ts` - å‹ãƒ»é–¢æ•°ã®ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ (tokenize, normalize, search, sortResults)
7. âœ… `matcher.test.ts` - 31ãƒ†ã‚¹ãƒˆå®Ÿè£… (IDç³»å®Œå…¨ä¸€è‡´ã€ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ç³»éƒ¨åˆ†ä¸€è‡´ã€ANDæ¤œç´¢ã€keywordé…åˆ—å¯¾å¿œ)
8. âœ… `matcher.ts` - IDç³»ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰å®Œå…¨ä¸€è‡´ã€ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ç³»éƒ¨åˆ†ä¸€è‡´ã€ANDæ¤œç´¢ãƒ­ã‚¸ãƒƒã‚¯ã€searché–¢æ•°å®Ÿè£…
9. âœ… `sorter.test.ts` - 16ãƒ†ã‚¹ãƒˆå®Ÿè£… (TDD: ãƒ†ã‚¹ãƒˆå…ˆè¡Œ) - ã‚½ãƒ¼ãƒˆå„ªå…ˆé †ä½ã€ã‚¨ãƒƒã‚¸ã‚±ãƒ¼ã‚¹ã€è¤‡é›‘ãªãƒãƒ«ãƒåŸºæº–ã‚½ãƒ¼ãƒˆ
10. âœ… `sorter.ts` - ãƒãƒƒãƒå¼·åº¦ãƒ»å¹´é™é †ãƒ»è‘—è€…ãƒ»ã‚¿ã‚¤ãƒˆãƒ«ãƒ»ç™»éŒ²é †ã‚½ãƒ¼ãƒˆã€è¤‡é›‘åº¦å‰Šæ¸›ã®ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°

**ãƒ†ã‚¹ãƒˆçµæœ**: å…¨95ãƒ†ã‚¹ãƒˆåˆæ ¼ (tokenizer: 26, normalizer: 22, matcher: 31, sorter: 16)

**å®Ÿè£…è©³ç´°**:
- **Tokenizer**:
  - ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰æŒ‡å®šå¯¾å¿œ: `author:`, `title:`, `year:`, `doi:`, `pmid:`, `pmcid:`, `url:`, `keyword:`
  - ãƒ•ãƒ¬ãƒ¼ã‚ºæ¤œç´¢: `"machine learning"` â†’ å˜ä¸€ãƒˆãƒ¼ã‚¯ãƒ³ã¨ã—ã¦æ‰±ã†
  - å¼•ç”¨ç¬¦ãªã—: `author:Smith year:2020` â†’ å„ãƒˆãƒ¼ã‚¯ãƒ³ã‚’è§£æ
  - ã‚¨ãƒƒã‚¸ã‚±ãƒ¼ã‚¹å‡¦ç†: æœªé–‰ã˜å¼•ç”¨ç¬¦ã€ç©ºå¼•ç”¨ç¬¦ã€ç©ºãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰å€¤

- **Normalizer**:
  - Unicodeæ­£è¦åŒ–: NFKC (compatibility) â†’ NFD (decompose) â†’ ç™ºéŸ³è¨˜å·é™¤å»
  - æ–‡å­—å‡¦ç†: å°æ–‡å­—åŒ–ã€å¥èª­ç‚¹å‰Šé™¤ã€ã‚¹ãƒ©ãƒƒã‚·ãƒ¥ä¿æŒ
  - ç©ºç™½æ­£è¦åŒ–: é€£ç¶šç©ºç™½â†’å˜ä¸€ç©ºç™½ã€trim
  - å¤šè¨€èªå¯¾å¿œ: CJKæ–‡å­—ä¿æŒã€ç™ºéŸ³è¨˜å·ä»˜ãæ¬§æ–‡æ­£è¦åŒ–

- **Matcher**:
  - IDç³»ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ (PMID, PMCID, DOI, URL): å®Œå…¨ä¸€è‡´ã€å¤§æ–‡å­—å°æ–‡å­—åŒºåˆ¥
  - ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ç³»ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ (title, author, keywordç­‰): éƒ¨åˆ†ä¸€è‡´ã€æ­£è¦åŒ–é©ç”¨
  - ANDæ¤œç´¢ãƒ­ã‚¸ãƒƒã‚¯: ã™ã¹ã¦ã®ãƒˆãƒ¼ã‚¯ãƒ³ãŒãƒãƒƒãƒå¿…è¦
  - ãƒãƒƒãƒå¼·åº¦è¨ˆç®—: exact/partial/noneã€ã‚¹ã‚³ã‚¢ç®—å‡º
  - ç‰¹æ®Šãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰å‡¦ç†: year (issued.date-parts), author (family + given initial)
  - URLæ¤œç´¢: primary URL + custom.additional_urlsé…åˆ—å¯¾å¿œ
  - keywordé…åˆ—: å„è¦ç´ ã«å¯¾ã—ã¦éƒ¨åˆ†ä¸€è‡´æ¤œç´¢
  - searché–¢æ•°: å‚ç…§æ–‡çŒ®é…åˆ—ã«å¯¾ã™ã‚‹ãƒãƒƒãƒãƒ³ã‚°å®Ÿè¡Œ

- **Sorter**:
  - 5æ®µéšã‚½ãƒ¼ãƒˆ: ãƒãƒƒãƒå¼·åº¦ (exact > partial) â†’ å¹´é™é † â†’ è‘—è€… â†’ ã‚¿ã‚¤ãƒˆãƒ« â†’ ç™»éŒ²é †
  - æ¬ æå€¤å‡¦ç†: å¹´ãªã— (0000æ‰±ã„)ã€è‘—è€…ãªã—ã€ã‚¿ã‚¤ãƒˆãƒ«ãªã—
  - å®‰å®šã‚½ãƒ¼ãƒˆ: å…ƒé…åˆ—ã®é †åºã‚’ä¿æŒ
  - ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°: è¤‡é›‘åº¦å‰Šæ¸›ã®ãŸã‚æ¯”è¼ƒé–¢æ•°ã‚’åˆ†é›¢

**å‹ä¿®æ­£**:
- `CslJsonItem` â†’ `CslItem` ã«çµ±ä¸€ (æ­£ã—ã„å‹åã«ä¿®æ­£)
- å½±éŸ¿ç¯„å›²: types.ts, matcher.ts, matcher.test.ts, sorter.ts, sorter.test.ts, tokenizer.ts

**Phase 3.1 å®Œäº†æ¡ä»¶é”æˆ**:
- âœ… ã‚¯ã‚¨ãƒªã®ãƒˆãƒ¼ã‚¯ãƒ³åŒ–ãŒå‹•ä½œ
- âœ… ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰æ­£è¦åŒ–ãŒå‹•ä½œ
- âœ… ãƒãƒƒãƒãƒ³ã‚° (IDç³»ãƒ»ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ç³»ã€ANDæ¤œç´¢) ãŒå‹•ä½œ
- âœ… æ¤œç´¢çµæœã®ã‚½ãƒ¼ãƒˆãŒä»•æ§˜é€šã‚Šã«å‹•ä½œ

#### 3.2 é‡è¤‡æ¤œå‡º âœ… å®Œäº† (2025-12-14)

**ç›®æ¨™**: DOI/PMID/ã‚¿ã‚¤ãƒˆãƒ«+è‘—è€…+å¹´ã«ã‚ˆã‚‹é‡è¤‡æ¤œå‡º

| ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ | ãƒ•ã‚¡ã‚¤ãƒ« | çŠ¶æ…‹ | èª¬æ˜ |
|--------------|---------|------|------|
| Duplicate Types | `src/features/duplicate/types.ts` | âœ… å®Œäº† | é‡è¤‡æ¤œå‡ºã®å‹å®šç¾© (DuplicateType, DuplicateMatch, DuplicateResult) |
| Detector | `src/features/duplicate/detector.ts` | âœ… å®Œäº† | é‡è¤‡æ¤œå‡ºãƒ­ã‚¸ãƒƒã‚¯ (DOI â†’ PMID â†’ Title+Author+Year) |
| Detector Test | `src/features/duplicate/detector.test.ts` | âœ… å®Œäº† | é‡è¤‡æ¤œå‡ºã®ãƒ†ã‚¹ãƒˆ (24ãƒ†ã‚¹ãƒˆåˆæ ¼) |
| Duplicate Index | `src/features/duplicate/index.ts` | âœ… å®Œäº† | é‡è¤‡æ¤œå‡ºã®ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ |

**å®Ÿè£…ä»•æ§˜**:
- `spec/features/duplicate-detection.md`
- `spec/features/metadata.md` - DOIæ­£è¦åŒ–ã€PMIDæŠ½å‡º

**å®Ÿè£…å®Œäº†**: 2025-12-14

**å®Ÿè£…å†…å®¹**:
1. âœ… `types.ts` - DuplicateType/DuplicateMatch/DuplicateResultå‹å®šç¾©
2. âœ… `detector.test.ts` - 24ãƒ†ã‚¹ãƒˆå®Ÿè£… (TDD: ãƒ†ã‚¹ãƒˆå…ˆè¡Œ)
   - DOIæ¤œå‡º: 5ãƒ†ã‚¹ãƒˆ (æ­£è¦åŒ–ã€å¤§æ–‡å­—å°æ–‡å­—åŒºåˆ¥)
   - PMIDæ¤œå‡º: 3ãƒ†ã‚¹ãƒˆ (å„ªå…ˆé †ä½æ¤œè¨¼)
   - ã‚¿ã‚¤ãƒˆãƒ«+è‘—è€…+å¹´æ¤œå‡º: 7ãƒ†ã‚¹ãƒˆ (æ­£è¦åŒ–ã€æ¬ æãƒ‡ãƒ¼ã‚¿)
   - ã‚¨ãƒƒã‚¸ã‚±ãƒ¼ã‚¹: 7ãƒ†ã‚¹ãƒˆ (UUIDè‡ªå·±æ¯”è¼ƒã€ç©ºãƒ©ã‚¤ãƒ–ãƒ©ãƒªã€è¤‡æ•°ãƒãƒƒãƒ)
   - å„ªå…ˆé †ä½: 2ãƒ†ã‚¹ãƒˆ (DOI > PMID > Title+Author+Year)
3. âœ… `detector.ts` - ç©ºå®Ÿè£… (`throw new Error("Not implemented")`)
4. âœ… ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ (Red) - å…¨24ãƒ†ã‚¹ãƒˆå¤±æ•—ç¢ºèª
5. âœ… `detector.ts` - å®Ÿè£… (DOI â†’ PMID â†’ ã‚¿ã‚¤ãƒˆãƒ«+è‘—è€…+å¹´ã®å„ªå…ˆé †ä½)
   - `normalizeDoi()` - DOIæ­£è¦åŒ– (https://doi.org/, doi: ãƒ—ãƒ¬ãƒ•ã‚£ãƒƒã‚¯ã‚¹å‰Šé™¤)
   - `extractYear()` - issued.date-parts ã‹ã‚‰å¹´æŠ½å‡º
   - `normalizeAuthors()` - family + given initial å½¢å¼ã«çµ±ä¸€
   - `checkDoiMatch()` - DOIå®Œå…¨ä¸€è‡´æ¤œæŸ» (å¤§æ–‡å­—å°æ–‡å­—åŒºåˆ¥)
   - `checkPmidMatch()` - PMIDå®Œå…¨ä¸€è‡´æ¤œæŸ»
   - `checkTitleAuthorYearMatch()` - ã‚¿ã‚¤ãƒˆãƒ«+è‘—è€…+å¹´ä¸€è‡´æ¤œæŸ» (æ­£è¦åŒ–å¾Œ)
   - `checkSingleDuplicate()` - å˜ä¸€ã‚¢ã‚¤ãƒ†ãƒ é‡è¤‡æ¤œæŸ» (å„ªå…ˆé †ä½é©ç”¨)
   - `detectDuplicate()` - ãƒ¡ã‚¤ãƒ³é–¢æ•° (UUIDè‡ªå·±æ¯”è¼ƒã‚¹ã‚­ãƒƒãƒ—)
6. âœ… ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ (Green) - å…¨24ãƒ†ã‚¹ãƒˆåˆæ ¼
7. âœ… `index.ts` - ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ (types, detectDuplicate)
8. âœ… ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚° - è¤‡é›‘åº¦å‰Šæ¸› (27 â†’ å„é–¢æ•°15ä»¥ä¸‹ã€6é–¢æ•°ã«åˆ†å‰²)
9. âœ… å“è³ªãƒã‚§ãƒƒã‚¯ - typecheck/lint/formatåˆæ ¼

**ãƒ†ã‚¹ãƒˆçµæœ**: å…¨24ãƒ†ã‚¹ãƒˆåˆæ ¼ (DOI: 5, PMID: 3, Title+Author+Year: 7, Edge cases: 7, Priority: 2)

**å®Ÿè£…è©³ç´°**:
- **DOIæ­£è¦åŒ–**: `https://doi.org/`, `http://dx.doi.org/`, `doi:` ãƒ—ãƒ¬ãƒ•ã‚£ãƒƒã‚¯ã‚¹å‰Šé™¤
- **è‘—è€…æ­£è¦åŒ–**: `family + given-initial` å½¢å¼ã€æ¤œç´¢normalizeræ´»ç”¨
- **å„ªå…ˆé †ä½**: DOI (æœ€å„ªå…ˆ) â†’ PMID â†’ ã‚¿ã‚¤ãƒˆãƒ«+è‘—è€…+å¹´ (æœ€çµ‚æ‰‹æ®µ)
- **UUIDå‡¦ç†**: åŒã˜UUIDã®å ´åˆã¯ã‚¹ã‚­ãƒƒãƒ— (è‡ªå·±æ¯”è¼ƒå›é¿)
- **æ¬ æãƒ‡ãƒ¼ã‚¿å¯¾å¿œ**: DOI/PMID/ã‚¿ã‚¤ãƒˆãƒ«/è‘—è€…/å¹´ãŒãªã„å ´åˆã®å‡¦ç†
- **è¤‡æ•°ãƒãƒƒãƒ**: è¤‡æ•°ã®é‡è¤‡ãŒæ¤œå‡ºã•ã‚ŒãŸå ´åˆã®é…åˆ—è¿”å´

**Phase 3.2 å®Œäº†æ¡ä»¶é”æˆ**:
- âœ… DOIã«ã‚ˆã‚‹é‡è¤‡æ¤œå‡ºãŒå‹•ä½œ
- âœ… PMIDã«ã‚ˆã‚‹é‡è¤‡æ¤œå‡ºãŒå‹•ä½œ
- âœ… ã‚¿ã‚¤ãƒˆãƒ«+è‘—è€…+å¹´ã«ã‚ˆã‚‹é‡è¤‡æ¤œå‡ºãŒå‹•ä½œ
- âœ… å„ªå…ˆé †ä½ (DOI > PMID > Title+Author+Year) ãŒæ­£ã—ãé©ç”¨ã•ã‚Œã‚‹
- âœ… ã‚¨ãƒƒã‚¸ã‚±ãƒ¼ã‚¹ (æ¬ æãƒ‡ãƒ¼ã‚¿ã€UUIDè‡ªå·±æ¯”è¼ƒã€ç©ºãƒ©ã‚¤ãƒ–ãƒ©ãƒª) ãŒé©åˆ‡ã«å‡¦ç†ã•ã‚Œã‚‹

#### 3.3 3-wayãƒãƒ¼ã‚¸ âœ… å®Œäº† (2025-12-15)

**ç›®æ¨™**: Last-Write-Wins (LWW) æˆ¦ç•¥ã«ã‚ˆã‚‹ç«¶åˆæ¤œå‡ºã¨è‡ªå‹•è§£æ±º

| ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ | ãƒ•ã‚¡ã‚¤ãƒ« | çŠ¶æ…‹ | èª¬æ˜ |
|--------------|---------|------|------|
| Core Types Update | `src/core/csl-json/types.ts` | âœ… å®Œäº† | `created_at` + `timestamp` å¯¾å¿œ |
| UUID Migration | `src/core/identifier/uuid.ts` | âœ… å®Œäº† | ãƒ¬ã‚¬ã‚·ãƒ¼ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å¯¾å¿œ |
| Reference Update | `src/core/reference.ts` | âœ… å®Œäº† | `getCreatedAt()`, `touch()` è¿½åŠ  |
| Merge Types | `src/features/merge/types.ts` | âœ… å®Œäº† | ãƒãƒ¼ã‚¸çµæœã€ç«¶åˆã€LWWã®å‹å®šç¾© |
| Three-way Merge | `src/features/merge/three-way.ts` | âœ… å®Œäº† | LWWå¯¾å¿œ3-wayãƒãƒ¼ã‚¸ãƒ­ã‚¸ãƒƒã‚¯ |
| Merge Test | `src/features/merge/three-way.test.ts` | âœ… å®Œäº† | LWWæˆ¦ç•¥ã®ãƒ†ã‚¹ãƒˆ (21ãƒ†ã‚¹ãƒˆåˆæ ¼) |
| Merge Index | `src/features/merge/index.ts` | âœ… å®Œäº† | ãƒãƒ¼ã‚¸ã®ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ |

**å®Ÿè£…ä»•æ§˜**:
- `spec/features/write-safety.md` - LWWãƒãƒ¼ã‚¸æˆ¦ç•¥
- `spec/core/data-model.md` - `created_at` + `timestamp` å®šç¾©

**ä¸»è¦ãªå¤‰æ›´ç‚¹**:
1. **ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®å†å®šç¾©**:
   - `custom.created_at`: ä½œæˆæ—¥æ™‚ï¼ˆä¸å¤‰ã€æ—§ `timestamp` ã‹ã‚‰ç§»è¡Œï¼‰
   - `custom.timestamp`: æœ€çµ‚æ›´æ–°æ—¥æ™‚ï¼ˆLWWã§ä½¿ç”¨ï¼‰

2. **LWW (Last-Write-Wins) æˆ¦ç•¥**:
   - ç«¶åˆæ™‚ã« `custom.timestamp` ã‚’æ¯”è¼ƒ
   - æ–°ã—ã„ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—ãŒè‡ªå‹•çš„ã«å„ªå…ˆã•ã‚Œã‚‹
   - åŒæ™‚åˆ»ã®å ´åˆã®ã¿ `--prefer` ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã¾ãŸã¯ç«¶åˆå ±å‘Š

3. **è‡ªå‹•è§£æ±ºã®æœ€å¤§åŒ–**:
   - ã»ã¨ã‚“ã©ã®ç«¶åˆãŒã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—ã§è‡ªå‹•è§£æ±º
   - ãƒ¦ãƒ¼ã‚¶ãƒ¼ä»‹å…¥ã‚’æœ€å°é™ã«æŠ‘ãˆã‚‹

**å®Ÿè£…å®Œäº†**: 2025-12-15

**å®Ÿè£…å†…å®¹**:
1. âœ… **æ—¢å­˜ã‚³ãƒ¼ãƒ‰ã®ä¿®æ­£** (created_at/timestamp ç§»è¡Œ):
   - `src/core/csl-json/types.ts` - `CslCustom` å‹æ›´æ–°
   - `src/core/identifier/uuid.ts` - ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãƒ­ã‚¸ãƒƒã‚¯å®Ÿè£…
   - `src/core/reference.ts` - `getCreatedAt()`, `getTimestamp()`, `touch()` è¿½åŠ 
   - å…¨æ—¢å­˜ãƒ†ã‚¹ãƒˆã®ä¿®æ­£ãƒ»å®Ÿè¡Œ

2. âœ… **3-wayãƒãƒ¼ã‚¸æ©Ÿèƒ½å®Ÿè£…** (TDD):
   - `src/features/merge/types.ts` - ãƒãƒ¼ã‚¸é–¢é€£å‹å®šç¾© (MergeResult, ItemConflict, FieldConflictç­‰)
   - `src/features/merge/three-way.test.ts` - ãƒ†ã‚¹ãƒˆå…ˆè¡Œå®Ÿè£… (21ãƒ†ã‚¹ãƒˆ)
   - `src/features/merge/three-way.ts` - LWWå¯¾å¿œãƒãƒ¼ã‚¸ãƒ­ã‚¸ãƒƒã‚¯
   - `src/features/merge/index.ts` - ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ

**å®Ÿè£…è©³ç´°**:
- **UUIDåŒä¸€æ€§åˆ¤å®š**: `custom.uuid` ã«ã‚ˆã‚‹ã‚¢ã‚¤ãƒ†ãƒ ãƒãƒƒãƒãƒ³ã‚°
- **ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰å˜ä½æ¯”è¼ƒ**: 3-way diffã§base/local/remoteã‚’æ¯”è¼ƒ
- **LWWè‡ªå‹•è§£æ±º**: `custom.timestamp` ãŒæ–°ã—ã„æ–¹ã‚’è‡ªå‹•æ¡ç”¨
- **prefer ã‚ªãƒ—ã‚·ãƒ§ãƒ³**: åŒæ™‚åˆ»ã®å ´åˆã®æ‰‹å‹•è§£æ±º (`--prefer=local|remote`)
- **è¿½åŠ ãƒ»å‰Šé™¤æ¤œå‡º**: localOnly, remoteOnly, deletedInLocal, deletedInRemote
- **ç«¶åˆãƒ¬ãƒãƒ¼ãƒˆ**: æœªè§£æ±ºã®ç«¶åˆã‚’ `ItemConflict` ã¨ã—ã¦å ±å‘Š

**ãƒ†ã‚¹ãƒˆçµæœ**: å…¨21ãƒ†ã‚¹ãƒˆåˆæ ¼
- ç‰‡æ–¹ã®ã¿å¤‰æ›´ï¼ˆè‡ªå‹•è§£æ±ºï¼‰
- ä¸¡æ–¹ãŒåŒã˜å¤‰æ›´ï¼ˆè‡ªå‹•è§£æ±ºï¼‰
- ä¸¡æ–¹ãŒç•°ãªã‚‹å¤‰æ›´ + local timestamp > remoteï¼ˆLWW: localå„ªå…ˆï¼‰
- ä¸¡æ–¹ãŒç•°ãªã‚‹å¤‰æ›´ + remote timestamp > localï¼ˆLWW: remoteå„ªå…ˆï¼‰
- åŒæ™‚åˆ» + `--prefer=local`ï¼ˆlocalå„ªå…ˆï¼‰
- åŒæ™‚åˆ» + `--prefer=remote`ï¼ˆremoteå„ªå…ˆï¼‰
- åŒæ™‚åˆ» + `--prefer`ãªã—ï¼ˆç«¶åˆå ±å‘Šï¼‰
- è¿½åŠ ãƒ»å‰Šé™¤ã®ãƒãƒ¼ã‚¸

**Phase 3.3 å®Œäº†æ¡ä»¶é”æˆ**:
- âœ… UUIDåŒä¸€æ€§åˆ¤å®šã«ã‚ˆã‚‹å‚ç…§æ–‡çŒ®ãƒãƒƒãƒãƒ³ã‚°ãŒå‹•ä½œ
- âœ… ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰å˜ä½ã®3-wayæ¯”è¼ƒãŒå‹•ä½œ
- âœ… `custom.timestamp` ã«ã‚ˆã‚‹ LWW è‡ªå‹•è§£æ±ºãŒå‹•ä½œ
- âœ… `--prefer=local|remote` ã«ã‚ˆã‚‹åŒæ™‚åˆ»ç«¶åˆã®æ‰‹å‹•è§£æ±ºãŒå‹•ä½œ
- âœ… è¿½åŠ ãƒ»å‰Šé™¤ã®æ¤œå‡ºãŒå‹•ä½œ

#### 3.4 ãƒ•ã‚¡ã‚¤ãƒ«ç›£è¦– âœ… å®Œäº† (2025-12-15)

**ç›®æ¨™**: CSL-JSONãƒ•ã‚¡ã‚¤ãƒ«ã®å¤‰æ›´ç›£è¦–ã¨è‡ªå‹•ãƒªãƒ­ãƒ¼ãƒ‰

| ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ | ãƒ•ã‚¡ã‚¤ãƒ« | çŠ¶æ…‹ | èª¬æ˜ |
|--------------|---------|------|------|
| FileWatcher | `src/features/file-watcher/file-watcher.ts` | âœ… å®Œäº† | chokidarãƒ™ãƒ¼ã‚¹ã®ç›£è¦– |
| FileWatcher Test | `src/features/file-watcher/file-watcher.test.ts` | âœ… å®Œäº† | ç›£è¦–ã®ãƒ†ã‚¹ãƒˆ (26ãƒ†ã‚¹ãƒˆåˆæ ¼) |
| Watcher Index | `src/features/file-watcher/index.ts` | âœ… å®Œäº† | ãƒ•ã‚¡ã‚¤ãƒ«ç›£è¦–ã®ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ |

**å®Ÿè£…ä»•æ§˜**: `spec/features/file-monitoring.md`

**å®Ÿè£…å®Œäº†**: 2025-12-15

**å®Ÿè£…å†…å®¹**:
1. âœ… `file-watcher.ts` - chokidarãƒ™ãƒ¼ã‚¹ã®ç›£è¦–ã‚¯ãƒ©ã‚¹
   - debounce 500ms (ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ)
   - polling fallback (5sé–“éš”)
   - JSON parse retry (200ms Ã— 10)
   - ç„¡è¦–ãƒ‘ã‚¿ãƒ¼ãƒ³: `*.tmp`, `*.bak`, `*.conflict.*`, `*.lock`, editor swap files
2. âœ… `file-watcher.test.ts` - 26ãƒ†ã‚¹ãƒˆåˆæ ¼
   - ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ã¨ã‚ªãƒ—ã‚·ãƒ§ãƒ³
   - ç„¡è¦–ãƒ‘ã‚¿ãƒ¼ãƒ³æ¤œè¨¼
   - å¤‰æ›´æ¤œå‡ºã¨debounce
   - polling ãƒ¢ãƒ¼ãƒ‰
   - ã‚¤ãƒ™ãƒ³ãƒˆç™ºè¡Œ
   - JSON parse retry
3. âœ… `index.ts` - FileWatcher, FileWatcherOptions ã®ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ

**ãƒ†ã‚¹ãƒˆçµæœ**: å…¨26ãƒ†ã‚¹ãƒˆåˆæ ¼

**ä¾å­˜é–¢ä¿‚è¿½åŠ **:
- `chokidar` (dependencies)
- `@types/chokidar` (devDependencies)

**Phase 3 å®Œäº†æ¡ä»¶é”æˆ**:
- âœ… æ¤œç´¢ (PMID/DOI/ã‚¿ã‚¤ãƒˆãƒ«+è‘—è€…) ãŒå‹•ä½œ
- âœ… é‡è¤‡æ¤œå‡ºãŒå‹•ä½œ
- âœ… 3-wayãƒãƒ¼ã‚¸ãŒå‹•ä½œ
- âœ… ãƒ•ã‚¡ã‚¤ãƒ«ç›£è¦–ãƒ»ãƒªãƒ­ãƒ¼ãƒ‰ãŒå‹•ä½œ

---

### Phase 4: ã‚µãƒ¼ãƒãƒ¼ã¨CLI (Server & CLI) ğŸŸ¢ å„ªå…ˆåº¦: ä¸­ä½

#### 4.1 HTTPã‚µãƒ¼ãƒãƒ¼ âœ… å®Œäº† (2025-12-15)

**ç›®æ¨™**: Honoãƒ™ãƒ¼ã‚¹ã®ãƒ­ãƒ¼ã‚«ãƒ«ã‚µãƒ¼ãƒãƒ¼

| ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ | ãƒ•ã‚¡ã‚¤ãƒ« | çŠ¶æ…‹ | èª¬æ˜ |
|--------------|---------|------|------|
| Server Entry | `src/server/index.ts` | âœ… å®Œäº† | ã‚µãƒ¼ãƒãƒ¼ã‚¨ãƒ³ãƒˆãƒªãƒ¼ãƒã‚¤ãƒ³ãƒˆ (3ãƒ†ã‚¹ãƒˆ) |
| Server Test | `src/server/index.test.ts` | âœ… å®Œäº† | ã‚µãƒ¼ãƒãƒ¼ã®ãƒ†ã‚¹ãƒˆ (3ãƒ†ã‚¹ãƒˆ) |
| Portfile | `src/server/portfile.ts` | âœ… å®Œäº† | ãƒãƒ¼ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ç®¡ç† (16ãƒ†ã‚¹ãƒˆ) |
| Portfile Test | `src/server/portfile.test.ts` | âœ… å®Œäº† | ãƒãƒ¼ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ç®¡ç†ã®ãƒ†ã‚¹ãƒˆ (16ãƒ†ã‚¹ãƒˆ) |
| References Route | `src/server/routes/references.ts` | âœ… å®Œäº† | å‚è€ƒæ–‡çŒ®CRUD API (10ãƒ†ã‚¹ãƒˆ) |
| References Test | `src/server/routes/references.test.ts` | âœ… å®Œäº† | å‚è€ƒæ–‡çŒ®APIã®ãƒ†ã‚¹ãƒˆ (10ãƒ†ã‚¹ãƒˆ) |
| Health Route | `src/server/routes/health.ts` | âœ… å®Œäº† | ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯API (4ãƒ†ã‚¹ãƒˆ) |
| Health Test | `src/server/routes/health.test.ts` | âœ… å®Œäº† | ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯ã®ãƒ†ã‚¹ãƒˆ (4ãƒ†ã‚¹ãƒˆ) |
| Validator Update | `src/core/csl-json/validator.ts` | âœ… å®Œäº† | `validateCslItem` é–¢æ•°è¿½åŠ  |

**å®Ÿè£…ä»•æ§˜**: `spec/architecture/http-server.md`

**å®Ÿè£…å®Œäº†**: 2025-12-15

**å®Ÿè£…å†…å®¹**:
1. âœ… `portfile.ts` - å‹•çš„ãƒãƒ¼ãƒˆå‰²ã‚Šå½“ã¦ã€ãƒãƒ¼ãƒˆãƒ•ã‚¡ã‚¤ãƒ«èª­ã¿æ›¸ã
   - `getPortfilePath()` - ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆãƒãƒ¼ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¹å–å¾—
   - `writePortfile()` - ãƒãƒ¼ãƒˆãƒ»PIDæ›¸ãè¾¼ã¿
   - `readPortfile()` - ãƒãƒ¼ãƒˆãƒ»PIDèª­ã¿è¾¼ã¿
   - `portfileExists()` - ãƒãƒ¼ãƒˆãƒ•ã‚¡ã‚¤ãƒ«å­˜åœ¨ç¢ºèª
   - `removePortfile()` - ãƒãƒ¼ãƒˆãƒ•ã‚¡ã‚¤ãƒ«å‰Šé™¤
   - `isProcessRunning()` - ãƒ—ãƒ­ã‚»ã‚¹å­˜åœ¨ç¢ºèª
2. âœ… `portfile.test.ts` - 16ãƒ†ã‚¹ãƒˆ (TDD: ãƒ†ã‚¹ãƒˆå…ˆè¡Œ)
   - ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆãƒ‘ã‚¹ã€èª­ã¿æ›¸ãã€å‰Šé™¤ã€ãƒ—ãƒ­ã‚»ã‚¹ç¢ºèª
3. âœ… `routes/health.ts` - ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ
   - `GET /health` - ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ç¢ºèª
4. âœ… `routes/health.test.ts` - 4ãƒ†ã‚¹ãƒˆ
   - ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯ãƒ¬ã‚¹ãƒãƒ³ã‚¹æ¤œè¨¼
5. âœ… `routes/references.ts` - CRUD API (å†…éƒ¨ç”¨)
   - `GET /api/references` - å…¨å‚ç…§æ–‡çŒ®å–å¾—
   - `GET /api/references/:uuid` - UUIDæŒ‡å®šå–å¾—
   - `POST /api/references` - æ–°è¦ä½œæˆ
   - `PUT /api/references/:uuid` - æ›´æ–°
   - `DELETE /api/references/:uuid` - å‰Šé™¤
6. âœ… `routes/references.test.ts` - 10ãƒ†ã‚¹ãƒˆ
   - å„ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã®ãƒ†ã‚¹ãƒˆã€ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°
7. âœ… `index.ts` - Honoã‚µãƒ¼ãƒãƒ¼ã‚¨ãƒ³ãƒˆãƒªãƒ¼ãƒã‚¤ãƒ³ãƒˆ
   - `createServer()` - ã‚µãƒ¼ãƒãƒ¼ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ä½œæˆ
   - `/health` ãƒ«ãƒ¼ãƒˆçµ±åˆ
   - `/api/references` ãƒ«ãƒ¼ãƒˆçµ±åˆ
8. âœ… `index.test.ts` - 3ãƒ†ã‚¹ãƒˆ
   - ã‚µãƒ¼ãƒãƒ¼ä½œæˆã€ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯ã€å‚ç…§æ–‡çŒ®ãƒ«ãƒ¼ãƒˆæ¤œè¨¼
9. âœ… `validator.ts` - `validateCslItem()` è¿½åŠ 
   - å˜ä¸€ã‚¢ã‚¤ãƒ†ãƒ ã®ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ (ã‚¨ãƒ©ãƒ¼è©³ç´°ä»˜ã)

**ãƒ†ã‚¹ãƒˆçµæœ**: å…¨33ãƒ†ã‚¹ãƒˆåˆæ ¼ (portfile: 16, health: 4, references: 10, server: 3)

**ä¾å­˜é–¢ä¿‚è¿½åŠ **:
- `hono` (dependencies)

**Phase 4.1 å®Œäº†æ¡ä»¶é”æˆ**:
- âœ… Honoãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã§ã‚µãƒ¼ãƒãƒ¼ä½œæˆ
- âœ… å‹•çš„ãƒãƒ¼ãƒˆå‰²ã‚Šå½“ã¦ã¨ãƒãƒ¼ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ç®¡ç†
- âœ… ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ
- âœ… å‚ç…§æ–‡çŒ®CRUD API
- âœ… å…¨ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã®ãƒ†ã‚¹ãƒˆã‚«ãƒãƒ¬ãƒƒã‚¸

#### 4.2 CLI ğŸŸ  Phase Aãƒ»Bãƒ»C å®Œäº† (2025-12-16)

**ç›®æ¨™**: commanderãƒ™ãƒ¼ã‚¹ã®CLIå®Ÿè£…ã€ã‚µãƒ¼ãƒãƒ¼çµ±åˆ

| ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ | ãƒ•ã‚¡ã‚¤ãƒ« | çŠ¶æ…‹ | èª¬æ˜ |
|--------------|---------|------|------|
| **åŸºç›¤æ‹¡å¼µ** | | âœ… å®Œäº† | Phase Aå®Œäº† (67ãƒ†ã‚¹ãƒˆ) |
| Config Schema | `src/config/schema.ts` | âœ… å®Œäº† | serverè¨­å®šè¿½åŠ  (17ãƒ†ã‚¹ãƒˆ) |
| Portfile | `src/server/portfile.ts` | âœ… å®Œäº† | library/started_atè¿½åŠ  (20ãƒ†ã‚¹ãƒˆ) |
| Library Hash | `src/core/library.ts` | âœ… å®Œäº† | ãƒ•ã‚¡ã‚¤ãƒ«ãƒãƒƒã‚·ãƒ¥è¿½è·¡ (30ãƒ†ã‚¹ãƒˆ) |
| **å‡ºåŠ›ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«** | | âœ… å®Œäº† | Phase Bå®Œäº† (53ãƒ†ã‚¹ãƒˆ) |
| JSON Output | `src/cli/output/json.ts` | âœ… å®Œäº† | JSONå‡ºåŠ› (9ãƒ†ã‚¹ãƒˆ) |
| Pretty Output | `src/cli/output/pretty.ts` | âœ… å®Œäº† | æ•´å½¢æ¸ˆã¿å‡ºåŠ› (19ãƒ†ã‚¹ãƒˆ) |
| BibTeX Output | `src/cli/output/bibtex.ts` | âœ… å®Œäº† | BibTeXå¤‰æ›å‡ºåŠ› (25ãƒ†ã‚¹ãƒˆ) |
| Output Index | `src/cli/output/index.ts` | âœ… å®Œäº† | å‡ºåŠ›ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ |
| **CLI-Serverçµ±åˆ** | | âœ… å®Œäº† | Phase Cå®Œäº† (21ãƒ†ã‚¹ãƒˆ) |
| Server Client | `src/cli/server-client.ts` | âœ… å®Œäº† | ã‚µãƒ¼ãƒãƒ¼APIå®¢æˆ·ç«¯ (12ãƒ†ã‚¹ãƒˆ) |
| Server Detection | `src/cli/server-detection.ts` | âœ… å®Œäº† | ã‚µãƒ¼ãƒãƒ¼æ¤œå‡ºãƒ»è‡ªå‹•èµ·å‹• (9ãƒ†ã‚¹ãƒˆ) |
| **ã‚³ãƒãƒ³ãƒ‰** | | ğŸŸ  éƒ¨åˆ†å®Œäº† | Phase Déƒ¨åˆ†å®Œäº† (22ãƒ†ã‚¹ãƒˆ) |
| List Command | `src/cli/commands/list.ts` | âœ… å®Œäº† | ä¸€è¦§è¡¨ç¤º (7ãƒ†ã‚¹ãƒˆ) |
| Search Command | `src/cli/commands/search.ts` | âœ… å®Œäº† | æ¤œç´¢ (7ãƒ†ã‚¹ãƒˆ) |
| Add Command | `src/cli/commands/add.ts` | âœ… å®Œäº† | å‚è€ƒæ–‡çŒ®è¿½åŠ ï¼ˆé‡è¤‡æ¤œå‡ºãƒ»IDè¡çªå‡¦ç†ï¼‰ (5ãƒ†ã‚¹ãƒˆ) |
| Remove Command | `src/cli/commands/remove.ts` | âœ… å®Œäº† | å‰Šé™¤ (4ãƒ†ã‚¹ãƒˆ) |
| Update Command | `src/cli/commands/update.ts` | âœ… å®Œäº† | æ›´æ–° (6ãƒ†ã‚¹ãƒˆ) |
| Server Command | `src/cli/commands/server.ts` | âŒ æœªå®Ÿè£… | ã‚µãƒ¼ãƒãƒ¼ç®¡ç†ï¼ˆstart/stop/statusï¼‰ |
| Commands Index | `src/cli/commands/index.ts` | âœ… å®Œäº† | ã‚³ãƒãƒ³ãƒ‰ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ |
| **CLI Entry** | | | |
| CLI Entry | `src/cli/index.ts` | âŒ æœªå®Ÿè£… | Commanderã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ— |
| CLI Entry Test | `src/cli/index.test.ts` | âŒ æœªå®Ÿè£… | CLIã‚¨ãƒ³ãƒˆãƒªãƒ¼ã®ãƒ†ã‚¹ãƒˆ |

**å®Ÿè£…ä»•æ§˜**:
- `spec/architecture/cli.md` - CLIåŸºæœ¬ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£
- `spec/architecture/cli-commands.md` - å…¨ã‚³ãƒãƒ³ãƒ‰è©³ç´°ä»•æ§˜
- `spec/architecture/cli-advanced.md` - Exit codeã€ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã€ç›£è¦–ã€å¯¾è©±æ©Ÿèƒ½
- `spec/architecture/cli-server-integration.md` - CLIã¨ã‚µãƒ¼ãƒãƒ¼ã®çµ±åˆ

**å®Ÿè£…é †åº**:

**Phase A: åŸºç›¤æ‹¡å¼µ** (æ—¢å­˜ã‚³ãƒ¼ãƒ‰ä¿®æ­£)
1. `src/config/schema.ts` - serverè¨­å®šè¿½åŠ 
   - `serverConfigSchema`: `autoStart`, `autoStopMinutes`
   - snake_caseå¯¾å¿œ: `auto_start`, `auto_stop_minutes`
2. `src/config/defaults.ts` - serverãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤è¿½åŠ 
3. `src/server/portfile.ts` - ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆæ‹¡å¼µ
   - `library`ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰è¿½åŠ ï¼ˆå¿…é ˆï¼‰
   - `started_at`ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰è¿½åŠ ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰
   - å¾Œæ–¹äº’æ›æ€§ç¢ºä¿
4. `src/core/library.ts` - ãƒ•ã‚¡ã‚¤ãƒ«ãƒãƒƒã‚·ãƒ¥è¿½è·¡
   - `currentHash`ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£è¿½åŠ 
   - `load()`å¾Œã®ãƒãƒƒã‚·ãƒ¥æ›´æ–°
   - `save()`å¾Œã®ãƒãƒƒã‚·ãƒ¥æ›´æ–°

**Phase B: å‡ºåŠ›ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«**
5. `src/cli/output/json.ts` - JSONå‡ºåŠ›
6. `src/cli/output/pretty.ts` - Prettyå‡ºåŠ›ï¼ˆ`[id] title`å½¢å¼ï¼‰
7. `src/cli/output/bibtex.ts` - BibTeXå¤‰æ›ï¼ˆè‡ªå‰å®Ÿè£…ï¼‰
8. `src/cli/output/index.ts` - ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ

**Phase C: CLI-Serverçµ±åˆ** âœ… å®Œäº† (2025-12-16)
9. âœ… `src/cli/server-client.ts` - ServerClient class
   - HTTP APIå‘¼ã³å‡ºã—ï¼ˆgetAll, findByUuid, add, update, removeï¼‰
   - ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°
   - ãƒ†ã‚¹ãƒˆ: 12ãƒ†ã‚¹ãƒˆåˆæ ¼
10. âœ… `src/cli/server-detection.ts` - ã‚µãƒ¼ãƒãƒ¼æ¤œå‡ºãƒ»è‡ªå‹•èµ·å‹•
    - `getServerConnection()` - portfileèª­ã¿è¾¼ã¿ã€æ¤œè¨¼ã€library pathç…§åˆ
    - `startServerDaemon()` - auto_startæ™‚ã®ã‚µãƒ¼ãƒãƒ¼èµ·å‹•
    - `waitForPortfile()` - ãƒãƒ¼ãƒˆãƒ•ã‚¡ã‚¤ãƒ«å¾…æ©Ÿï¼ˆ5ç§’ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆï¼‰
    - ãƒ†ã‚¹ãƒˆ: 9ãƒ†ã‚¹ãƒˆåˆæ ¼

**å®Ÿè£…å®Œäº†**: 2025-12-16

**å®Ÿè£…å†…å®¹**:
1. âœ… `server-client.ts` - ServerClient classå®Ÿè£…
   - `getAll()` - å…¨å‚ç…§æ–‡çŒ®å–å¾—
   - `findByUuid(uuid)` - UUIDæŒ‡å®šå–å¾—
   - `add(item)` - æ–°è¦è¿½åŠ 
   - `update(uuid, item)` - æ›´æ–°
   - `remove(uuid)` - å‰Šé™¤
   - ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ï¼ˆ404, ãã®ä»–ã®HTTPã‚¨ãƒ©ãƒ¼ï¼‰
2. âœ… `server-client.test.ts` - 12ãƒ†ã‚¹ãƒˆå®Ÿè£…
   - å„APIãƒ¡ã‚½ãƒƒãƒ‰ã®ãƒ†ã‚¹ãƒˆ
   - ã‚¨ãƒ©ãƒ¼ã‚±ãƒ¼ã‚¹æ¤œè¨¼
3. âœ… `server-detection.ts` - ã‚µãƒ¼ãƒãƒ¼æ¤œå‡ºãƒ»è‡ªå‹•èµ·å‹•å®Ÿè£…
   - `getServerConnection()` - portfileå­˜åœ¨ç¢ºèªã€ãƒ—ãƒ­ã‚»ã‚¹ç¢ºèªã€library pathç…§åˆ
   - `startServerDaemon()` - daemon modeèµ·å‹•
   - `waitForPortfile()` - portfileç”Ÿæˆå¾…æ©Ÿï¼ˆ50msé–“éš”ã€5ç§’ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆï¼‰
   - auto_startå¯¾å¿œ - ã‚µãƒ¼ãƒãƒ¼ãªã—ã®å ´åˆè‡ªå‹•èµ·å‹•
4. âœ… `server-detection.test.ts` - 9ãƒ†ã‚¹ãƒˆå®Ÿè£…
   - portfileæ¤œå‡ºãƒ†ã‚¹ãƒˆ
   - auto_startæ©Ÿèƒ½ãƒ†ã‚¹ãƒˆ
   - library pathç…§åˆãƒ†ã‚¹ãƒˆ

**ãƒ†ã‚¹ãƒˆçµæœ**: å…¨21ãƒ†ã‚¹ãƒˆåˆæ ¼ (server-client: 12, server-detection: 9)

**Phase C å®Œäº†æ¡ä»¶é”æˆ**:
- âœ… ã‚µãƒ¼ãƒãƒ¼APIã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå®Ÿè£…å®Œäº†
- âœ… ã‚µãƒ¼ãƒãƒ¼æ¤œå‡ºãƒ»è‡ªå‹•èµ·å‹•å®Ÿè£…å®Œäº†
- âœ… portfileæ¤œè¨¼ãƒ»library pathç…§åˆå®Ÿè£…å®Œäº†
- âœ… å…¨ãƒ†ã‚¹ãƒˆåˆæ ¼

**Phase D: ã‚³ãƒãƒ³ãƒ‰å®Ÿè£…** ğŸŸ  éƒ¨åˆ†å®Œäº† (2025-12-16)
11. âœ… `src/cli/commands/list.ts` - ä¸€è¦§è¡¨ç¤º (7ãƒ†ã‚¹ãƒˆ)
    - å…¨å‚ç…§æ–‡çŒ®ã®ä¸€è¦§è¡¨ç¤º
    - å‡ºåŠ›ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ: pretty (default), --json, --ids-only, --uuid, --bibtex
    - ç›¸äº’æ’ä»–çš„ãªå‡ºåŠ›ã‚ªãƒ—ã‚·ãƒ§ãƒ³ãƒã‚§ãƒƒã‚¯
12. âœ… `src/cli/commands/search.ts` - æ¤œç´¢ (7ãƒ†ã‚¹ãƒˆ)
    - ã‚¯ã‚¨ãƒªãƒˆãƒ¼ã‚¯ãƒ³åŒ– + æ¤œç´¢å®Ÿè¡Œ + ã‚½ãƒ¼ãƒˆ
    - ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰æŒ‡å®šæ¤œç´¢ã€ANDæ¤œç´¢
    - å‡ºåŠ›ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆå¯¾å¿œ
13. âœ… `src/cli/commands/add.ts` - è¿½åŠ  (5ãƒ†ã‚¹ãƒˆ)
    - é‡è¤‡æ¤œå‡ºï¼ˆ`--force`å¯¾å¿œï¼‰
    - IDè¡çªå‡¦ç†ï¼ˆsuffixè¿½åŠ : a, b, c, ..., z, aa, ab, ...ï¼‰
14. âœ… `src/cli/commands/remove.ts` - å‰Šé™¤ (4ãƒ†ã‚¹ãƒˆ)
    - ID/UUIDæŒ‡å®šã§ã®å‰Šé™¤
    - å‰Šé™¤å¾Œã®æ®‹ã‚Šã‚¢ã‚¤ãƒ†ãƒ è¿”å´
15. âœ… `src/cli/commands/update.ts` - æ›´æ–° (6ãƒ†ã‚¹ãƒˆ)
    - éƒ¨åˆ†æ›´æ–°ã€timestampè‡ªå‹•æ›´æ–°ã€created_atä¿æŒ
    - ID/UUIDæŒ‡å®šã§ã®æ›´æ–°
16. â³ `src/cli/commands/server.ts` - ã‚µãƒ¼ãƒãƒ¼ç®¡ç† (æœªå®Ÿè£…)
    - `start` - ã‚µãƒ¼ãƒãƒ¼èµ·å‹•ï¼ˆforeground/daemonï¼‰
    - `stop` - ã‚µãƒ¼ãƒãƒ¼åœæ­¢
    - `status` - ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ç¢ºèª
17. âœ… `src/cli/commands/index.ts` - ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ

**Phase D å®Ÿè£…å†…å®¹** (2025-12-16):
- âœ… List/Search/Add/Remove/Updateã‚³ãƒãƒ³ãƒ‰å®Ÿè£…å®Œäº†
- âœ… é‡è¤‡æ¤œå‡ºãƒ»IDè¡çªå‡¦ç†ã®çµ±åˆ
- âœ… å‡ºåŠ›ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆçµ±ä¸€ (pretty/json/ids-only/uuid/bibtex)
- âœ… å…¨29ãƒ†ã‚¹ãƒˆåˆæ ¼ (list: 7, search: 7, add: 5, remove: 4, update: 6)
- â³ Server Commandã¯æ¬¡å›å®Ÿè£…äºˆå®š

**Phase E: CLIã‚¨ãƒ³ãƒˆãƒªãƒ¼**
18. `src/cli/index.ts` - Commanderã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
    - ã‚°ãƒ­ãƒ¼ãƒãƒ«ã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼ˆ`--library`, `--log-level`, `--quiet`ç­‰ï¼‰
    - å…¨ã‚³ãƒãƒ³ãƒ‰ç™»éŒ²
    - ã‚·ã‚°ãƒŠãƒ«ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ï¼ˆSIGINT, SIGTERMï¼‰
19. `src/cli/index.test.ts` - çµ±åˆãƒ†ã‚¹ãƒˆ

**ãƒ†ã‚¹ãƒˆè¦‹ç©ã‚‚ã‚Š**:
- åŸºç›¤æ‹¡å¼µ: ~15ãƒ†ã‚¹ãƒˆï¼ˆconfig, portfile, library hashï¼‰
- å‡ºåŠ›ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«: ~30ãƒ†ã‚¹ãƒˆï¼ˆjson, pretty, bibtexå„10ãƒ†ã‚¹ãƒˆï¼‰
- CLI-Serverçµ±åˆ: ~20ãƒ†ã‚¹ãƒˆï¼ˆserver-client, server-detectionï¼‰
- ã‚³ãƒãƒ³ãƒ‰: ~80ãƒ†ã‚¹ãƒˆï¼ˆå„ã‚³ãƒãƒ³ãƒ‰10-15ãƒ†ã‚¹ãƒˆï¼‰
- CLIã‚¨ãƒ³ãƒˆãƒªãƒ¼: ~10ãƒ†ã‚¹ãƒˆ
- **åˆè¨ˆ: ~155ãƒ†ã‚¹ãƒˆ**

**Phase 4.2 å®Œäº†æ¡ä»¶**:
- ğŸŸ  å…¨CLIã‚³ãƒãƒ³ãƒ‰ãŒå‹•ä½œï¼ˆâœ… add, search, list, remove, update / â³ serverï¼‰
- âœ… å‡ºåŠ›ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ (JSON, BibTeX, Pretty) ãŒå‹•ä½œ
- âœ… ã‚µãƒ¼ãƒãƒ¼è‡ªå‹•æ¤œå‡ºãƒ»è‡ªå‹•èµ·å‹•ãŒå‹•ä½œ
- âœ… IDè¡çªå‡¦ç†ãŒå‹•ä½œï¼ˆsuffixè¿½åŠ ï¼‰
- âœ… é‡è¤‡æ¤œå‡ºãŒå‹•ä½œï¼ˆ`--force`å¯¾å¿œï¼‰
- â³ ç¢ºèªãƒ—ãƒ­ãƒ³ãƒ—ãƒˆãŒå‹•ä½œï¼ˆTTYæ¤œå‡ºï¼‰ - ã‚³ãƒãƒ³ãƒ‰ãƒ­ã‚¸ãƒƒã‚¯ã®ã¿å®Ÿè£…ã€ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã¯æœªå®Ÿè£…
- â³ Exit codeãŒä»•æ§˜é€šã‚Š - CLIã‚¨ãƒ³ãƒˆãƒªãƒ¼æœªå®Ÿè£…ã®ãŸã‚æœªå¯¾å¿œ
- ğŸŸ  ãƒ†ã‚¹ãƒˆåˆæ ¼ï¼ˆPhase A-C: 141ãƒ†ã‚¹ãƒˆ / Phase D: 29ãƒ†ã‚¹ãƒˆ / åˆè¨ˆ: 170ãƒ†ã‚¹ãƒˆï¼‰

---

### Phase 5: ãƒ“ãƒ«ãƒ‰ãƒ»é…å¸ƒãƒ»CI (Build & Distribution) ğŸ”µ å„ªå…ˆåº¦: ä½

#### 5.1 ãƒ“ãƒ«ãƒ‰ã‚·ã‚¹ãƒ†ãƒ 

**ç›®æ¨™**: Viteãƒ“ãƒ«ãƒ‰ã€TypeScriptå‹å®šç¾©ã€npmé…å¸ƒ

| ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ | ãƒ•ã‚¡ã‚¤ãƒ« | çŠ¶æ…‹ | èª¬æ˜ |
|--------------|---------|------|------|
| Vite Config | `vite.config.ts` | âœ… å­˜åœ¨ | ãƒ“ãƒ«ãƒ‰è¨­å®š (è¦ç¢ºèªãƒ»èª¿æ•´) |
| TypeScript Config | `tsconfig.json` | âœ… å­˜åœ¨ | TypeScriptè¨­å®š (è¦ç¢ºèª) |
| Bin Entry | `bin/reference-manager.js` | âš ï¸ è¦ç¢ºèª | CLIã‚¨ãƒ³ãƒˆãƒªãƒ¼ã‚¹ã‚¯ãƒªãƒ—ãƒˆ |

**å®Ÿè£…ä»•æ§˜**: `spec/architecture/build-system.md`, `spec/architecture/runtime.md`

**å®Ÿè£…é †åº**:
1. `vite.config.ts` ã®èª¿æ•´ - ãƒ©ã‚¤ãƒ–ãƒ©ãƒªãƒ¢ãƒ¼ãƒ‰ã€ESMå‡ºåŠ›
2. `tsconfig.json` ã®ç¢ºèª
3. `bin/reference-manager.js` ã®å®Ÿè£… - `dist/cli/index.js` ã‚’å®Ÿè¡Œ
4. ãƒ“ãƒ«ãƒ‰å‹•ä½œç¢ºèª (`npm run build`)

#### 5.2 CI/CD

**ç›®æ¨™**: GitHub Actions ã«ã‚ˆã‚‹ãƒ†ã‚¹ãƒˆãƒ»ãƒ“ãƒ«ãƒ‰ãƒ»ãƒªãƒªãƒ¼ã‚¹

| ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ | ãƒ•ã‚¡ã‚¤ãƒ« | çŠ¶æ…‹ | èª¬æ˜ |
|--------------|---------|------|------|
| CI Workflow | `.github/workflows/ci.yml` | âš ï¸ è¦ç¢ºèª | ãƒ†ã‚¹ãƒˆãƒ»ãƒ“ãƒ«ãƒ‰ãƒ»å‹ãƒã‚§ãƒƒã‚¯ |

**å®Ÿè£…ä»•æ§˜**: `spec/guidelines/testing.md`

**å®Ÿè£…é †åº**:
1. `.github/workflows/ci.yml` ã®å®Ÿè£…/ç¢ºèª
2. ãƒ†ã‚¹ãƒˆãƒ»lintãƒ»å‹ãƒã‚§ãƒƒã‚¯ã®è‡ªå‹•åŒ–
3. npm publish ã®è‡ªå‹•åŒ– (ã‚ªãƒ—ã‚·ãƒ§ãƒ³)

**Phase 5 å®Œäº†æ¡ä»¶**:
- `npm run build` ã§ãƒ“ãƒ«ãƒ‰æˆåŠŸ
- `npm install -g reference-manager` ã§ã‚°ãƒ­ãƒ¼ãƒãƒ«ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«å¯èƒ½
- CI/CDãŒå‹•ä½œ

---

## ä¾å­˜é–¢ä¿‚ã‚°ãƒ©ãƒ•

```
Phase 1 (Core Foundation)
  â””â”€> Phase 2 (Utils & Config)
        â””â”€> Phase 3 (Features)
              â””â”€> Phase 4 (Server & CLI)
                    â””â”€> Phase 5 (Build & Distribution)
```

**ä¸¦è¡Œå®Ÿè£…å¯èƒ½ãªéƒ¨åˆ†**:
- Phase 1å†…: `1.1 CSL-JSONå‡¦ç†` ã¨ `1.2 è­˜åˆ¥å­ç”Ÿæˆ` ã¯ä¸¦è¡Œå¯èƒ½
- Phase 2å†…: `2.1 ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£` ã¨ `2.2 è¨­å®šç®¡ç†` ã¯ä¸¦è¡Œå¯èƒ½
- Phase 3å†…: å„æ©Ÿèƒ½ (search, duplicate, merge, file-watcher) ã¯ä¸¦è¡Œå¯èƒ½
- Phase 4å†…: `4.1 HTTPã‚µãƒ¼ãƒãƒ¼` ã¨ `4.2 CLI` ã¯ã‚ã‚‹ç¨‹åº¦ä¸¦è¡Œå¯èƒ½ (CLIãŒã‚µãƒ¼ãƒãƒ¼ã‚’èµ·å‹•ã™ã‚‹ãŸã‚ã€ã‚µãƒ¼ãƒãƒ¼ãŒå…ˆ)

---

## ãƒ†ã‚¹ãƒˆæˆ¦ç•¥

### å¿…é ˆãƒ†ã‚¹ãƒˆã‚«ãƒãƒ¬ãƒƒã‚¸

| ã‚«ãƒ†ã‚´ãƒª | ãƒ†ã‚¹ãƒˆå¯¾è±¡ | å„ªå…ˆåº¦ |
|---------|----------|--------|
| æ­£è¦åŒ– | `normalizer.test.ts` (search, identifier) | é«˜ |
| é‡è¤‡æ¤œå‡º | `detector.test.ts` | é«˜ |
| 3-wayãƒãƒ¼ã‚¸ | `three-way.test.ts` | é«˜ |
| IDç”Ÿæˆ | `generator.test.ts` | é«˜ |
| UUIDç®¡ç† | `uuid.test.ts` | ä¸­ |
| CSL-JSON I/O | `parser.test.ts`, `serializer.test.ts` | ä¸­ |
| ãƒ•ã‚¡ã‚¤ãƒ«ç›£è¦– | `watcher.test.ts` | ä¸­ |

### ãƒ†ã‚¹ãƒˆãƒ•ã‚£ã‚¯ã‚¹ãƒãƒ£

æ—¢å­˜ãƒ•ã‚£ã‚¯ã‚¹ãƒãƒ£ (å…¨ã¦ `/tests/fixtures/` ã«å­˜åœ¨):
- `sample.csl.json` - åŸºæœ¬ã‚µãƒ³ãƒ—ãƒ« (5ä»¶)
- `empty.csl.json` - ç©ºé…åˆ—
- `single-entry.csl.json` - 1ä»¶ã®ã¿
- `edge-cases.csl.json` - ã‚¨ãƒƒã‚¸ã‚±ãƒ¼ã‚¹ (è‘—è€…ãªã—ã€å¹´ãªã—ç­‰)
- `duplicates.csl.json` - é‡è¤‡æ¤œå‡ºç”¨
- `merge-scenarios.csl.json` - ãƒãƒ¼ã‚¸ã‚·ãƒŠãƒªã‚ªç”¨
- `invalid.json` - ä¸æ­£ãªJSON (ãƒãƒªãƒ‡ãƒ¼ã‚¿ãƒ¼ãƒ†ã‚¹ãƒˆç”¨) âœ…

---

## å“è³ªã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³

- **Linter/Formatter**: Biome (`npm run lint`, `npm run format`)
- **å‹ãƒã‚§ãƒƒã‚¯**: TypeScript (`npm run typecheck`)
- **ãƒ†ã‚¹ãƒˆ**: Vitest (`npm test`)
- **ã‚«ãƒãƒ¬ãƒƒã‚¸**: `npm run test:coverage`
- **ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ **: Linux, macOS, Windows (spec/guidelines/platform.md)

---

## æ¬¡ã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚¢ã‚¤ãƒ†ãƒ 

### ä»Šã™ãå®Ÿè£…ã™ã¹ãé …ç›® (Phase 4) â­ æœ€å„ªå…ˆ

**âœ… Phase 3: æ©Ÿèƒ½ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ« - å…¨å®Œäº†** (2025-12-15)

**âœ… Phase 3.1: Search Feature - å®Œäº†** (2025-12-14)

TDDæ‰‹é †ã«å¾“ã„ã€ã™ã¹ã¦ã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’ãƒ†ã‚¹ãƒˆé§†å‹•é–‹ç™ºã§å®Ÿè£…å®Œäº†ã€‚

**âœ… Phase 3.2: Duplicate Detection - å®Œäº†** (2025-12-14)

TDDæ‰‹é †ã«å¾“ã„ã€ã™ã¹ã¦ã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’ãƒ†ã‚¹ãƒˆé§†å‹•é–‹ç™ºã§å®Ÿè£…å®Œäº†ã€‚

1. âœ… **Search Types** (`src/features/search/types.ts`) - å®Œäº†
   - å†…å®¹: æ¤œç´¢ã‚¯ã‚¨ãƒªã€ãƒˆãƒ¼ã‚¯ãƒ³ã€ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰æŒ‡å®šã€çµæœã®å‹å®šç¾©
   - å‹: SearchQuery, SearchToken, FieldSpecifier, SearchResult, MatchStrengthç­‰
   - å‹ä¿®æ­£: CslJsonItem â†’ CslItem ã«çµ±ä¸€

2. âœ… **Tokenizer** (`src/features/search/tokenizer.ts` + ãƒ†ã‚¹ãƒˆ) - å®Œäº†
   - å®Ÿè£…: ã‚¯ã‚¨ãƒªæ–‡å­—åˆ—ã®ãƒˆãƒ¼ã‚¯ãƒ³åŒ–ã€å¼•ç”¨ç¬¦å‡¦ç†ã€ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰æŒ‡å®šè§£æã€å‹ã‚¨ãƒ©ãƒ¼ä¿®æ­£
   - ãƒ†ã‚¹ãƒˆ: 26ãƒ†ã‚¹ãƒˆåˆæ ¼ (ã‚¹ãƒšãƒ¼ã‚¹åŒºåˆ‡ã‚Šã€å¼•ç”¨ç¬¦ãƒ•ãƒ¬ãƒ¼ã‚ºã€ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰æŒ‡å®š)

3. âœ… **Normalizer** (`src/features/search/normalizer.ts` + ãƒ†ã‚¹ãƒˆ) - å®Œäº†
   - å®Ÿè£…: Unicode NFKCæ­£è¦åŒ–ã€å°æ–‡å­—åŒ–ã€è¨˜å·å‰Šé™¤ã€ç©ºç™½æ­£è¦åŒ–
   - ãƒ†ã‚¹ãƒˆ: 22ãƒ†ã‚¹ãƒˆåˆæ ¼ (å„ç¨®è¨€èªã€è¨˜å·ã€ã‚¨ãƒƒã‚¸ã‚±ãƒ¼ã‚¹)

4. âœ… **Matcher** (`src/features/search/matcher.ts` + ãƒ†ã‚¹ãƒˆ) - å®Œäº†
   - å®Ÿè£…: IDç³»å®Œå…¨ä¸€è‡´ã€ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ç³»éƒ¨åˆ†ä¸€è‡´ã€ANDæ¤œç´¢ãƒ­ã‚¸ãƒƒã‚¯ã€keywordé…åˆ—å¯¾å¿œã€searché–¢æ•°
   - ãƒ†ã‚¹ãƒˆ: 31ãƒ†ã‚¹ãƒˆåˆæ ¼ (IDç³»ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã€ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ç³»ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã€ANDæ¤œç´¢ã€ãƒãƒƒãƒå¼·åº¦ã€keywordé…åˆ—)

5. âœ… **Sorter** (`src/features/search/sorter.ts` + ãƒ†ã‚¹ãƒˆ) - å®Œäº†
   - å®Ÿè£…: ãƒãƒƒãƒå¼·åº¦ã€å¹´é™é †ã€è‘—è€…ã€ã‚¿ã‚¤ãƒˆãƒ«ã€ç™»éŒ²é †ã®ã‚½ãƒ¼ãƒˆã€è¤‡é›‘åº¦å‰Šæ¸›ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°
   - ãƒ†ã‚¹ãƒˆ: 16ãƒ†ã‚¹ãƒˆåˆæ ¼ (TDD) - ã‚½ãƒ¼ãƒˆå„ªå…ˆé †ä½ã€ã‚¨ãƒƒã‚¸ã‚±ãƒ¼ã‚¹ã€è¤‡é›‘ãªãƒãƒ«ãƒåŸºæº–ã‚½ãƒ¼ãƒˆ

6. âœ… **Search Index** (`src/features/search/index.ts`) - å®Œäº†
   - å†…å®¹: tokenize, normalize, search, sortResults ã®ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ

**å“è³ªä¿è¨¼**:
- âœ… å…¨95ãƒ†ã‚¹ãƒˆåˆæ ¼
- âœ… TypeScriptå‹ãƒã‚§ãƒƒã‚¯åˆæ ¼
- âœ… Lint/Formaté©ç”¨æ¸ˆã¿

1. âœ… **Duplicate Types** (`src/features/duplicate/types.ts`) - å®Œäº†
   - å†…å®¹: é‡è¤‡æ¤œå‡ºã®å‹å®šç¾©
   - å‹: DuplicateType, DuplicateMatch, DuplicateResult

2. âœ… **Detector Test** (`src/features/duplicate/detector.test.ts`) - å®Œäº†
   - å®Ÿè£…: 24ãƒ†ã‚¹ãƒˆ (TDD: ãƒ†ã‚¹ãƒˆå…ˆè¡Œ)
   - ãƒ†ã‚¹ãƒˆ: DOIæ¤œå‡º5ã€PMIDæ¤œå‡º3ã€ã‚¿ã‚¤ãƒˆãƒ«+è‘—è€…+å¹´æ¤œå‡º7ã€ã‚¨ãƒƒã‚¸ã‚±ãƒ¼ã‚¹7ã€å„ªå…ˆé †ä½2

3. âœ… **Detector** (`src/features/duplicate/detector.ts`) - å®Œäº†
   - å®Ÿè£…: é‡è¤‡æ¤œå‡ºãƒ­ã‚¸ãƒƒã‚¯ (DOI â†’ PMID â†’ Title+Author+Year)
   - é–¢æ•°: normalizeDoi, extractYear, normalizeAuthors, checkDoiMatch, checkPmidMatch, checkTitleAuthorYearMatch, checkSingleDuplicate, detectDuplicate
   - ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°: è¤‡é›‘åº¦å‰Šæ¸› (27 â†’ å„é–¢æ•°15ä»¥ä¸‹)

4. âœ… **Duplicate Index** (`src/features/duplicate/index.ts`) - å®Œäº†
   - å†…å®¹: types, detectDuplicate ã®ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ

**å“è³ªä¿è¨¼**:
- âœ… å…¨24ãƒ†ã‚¹ãƒˆåˆæ ¼
- âœ… TypeScriptå‹ãƒã‚§ãƒƒã‚¯åˆæ ¼
- âœ… Lint/Formaté©ç”¨æ¸ˆã¿

**âœ… Phase 3.3: 3-way Merge - å®Œäº†** (2025-12-15)

**å®Œäº†å†…å®¹**:
1. âœ… **Specæ›´æ–°å®Œäº†**:
   - âœ… `spec/core/data-model.md` - `created_at` + `timestamp` å®šç¾©è¿½åŠ 
   - âœ… `spec/features/write-safety.md` - LWWæˆ¦ç•¥è©³ç´°åŒ–
   - âœ… `ROADMAP.md` - Phase 3.3è©³ç´°è¿½åŠ 

2. âœ… **æ—¢å­˜ã‚³ãƒ¼ãƒ‰ä¿®æ­£å®Œäº†** (created_at/timestamp ç§»è¡Œ):
   - âœ… `src/core/csl-json/types.ts` - `CslCustom` å‹ã‚’ `created_at` + `timestamp` ã«æ›´æ–°
   - âœ… `src/core/identifier/uuid.ts` - ãƒ¬ã‚¬ã‚·ãƒ¼ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å®Ÿè£…
   - âœ… `src/core/reference.ts` - æ–°ãƒ¡ã‚½ãƒƒãƒ‰è¿½åŠ  (`getCreatedAt()`, `touch()`)

3. âœ… **3-wayãƒãƒ¼ã‚¸æ©Ÿèƒ½å®Ÿè£…** (TDD):
   - âœ… `src/features/merge/types.ts` - å‹å®šç¾© (MergeResult, ItemConflict, FieldConflictç­‰)
   - âœ… `src/features/merge/three-way.test.ts` - 21ãƒ†ã‚¹ãƒˆåˆæ ¼
   - âœ… `src/features/merge/three-way.ts` - LWWå¯¾å¿œãƒãƒ¼ã‚¸ãƒ­ã‚¸ãƒƒã‚¯
   - âœ… `src/features/merge/index.ts` - ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ

**å®Ÿè£…å®Œäº†æ©Ÿèƒ½**:
- âœ… UUIDåŒä¸€æ€§åˆ¤å®šã«ã‚ˆã‚‹å‚ç…§æ–‡çŒ®ãƒãƒƒãƒãƒ³ã‚°
- âœ… ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰å˜ä½ã®3-wayæ¯”è¼ƒ
- âœ… `custom.timestamp` ã«ã‚ˆã‚‹ Last-Write-Wins (LWW) è‡ªå‹•è§£æ±º
- âœ… `--prefer=local|remote` ã«ã‚ˆã‚‹åŒæ™‚åˆ»ç«¶åˆã®æ‰‹å‹•è§£æ±º
- âœ… è¿½åŠ ãƒ»å‰Šé™¤ã®æ¤œå‡º

**âœ… Phase 3.4: File Watcher - å®Œäº†** (2025-12-15)

TDDæ‰‹é †ã«å¾“ã„ã€ãƒ•ã‚¡ã‚¤ãƒ«ç›£è¦–æ©Ÿèƒ½ã‚’å®Ÿè£…å®Œäº†ã€‚

1. âœ… **FileWatcher** (`src/features/file-watcher/file-watcher.ts`) - å®Œäº†
   - å®Ÿè£…: chokidarãƒ™ãƒ¼ã‚¹ã®ç›£è¦–ã‚¯ãƒ©ã‚¹
   - æ©Ÿèƒ½: debounce (500ms)ã€polling fallback (5s)ã€JSON parse retry (200ms Ã— 10)
   - ç„¡è¦–ãƒ‘ã‚¿ãƒ¼ãƒ³: `*.tmp`, `*.bak`, `*.conflict.*`, `*.lock`, editor swap files
   - ãƒ†ã‚¹ãƒˆ: 26ãƒ†ã‚¹ãƒˆåˆæ ¼

2. âœ… **FileWatcher Index** (`src/features/file-watcher/index.ts`) - å®Œäº†
   - å†…å®¹: FileWatcher, FileWatcherOptions ã®ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ

**å“è³ªä¿è¨¼**:
- âœ… å…¨26ãƒ†ã‚¹ãƒˆåˆæ ¼
- âœ… TypeScriptå‹ãƒã‚§ãƒƒã‚¯åˆæ ¼
- âœ… Lint/Formaté©ç”¨æ¸ˆã¿

### æ¬¡ã®å®Ÿè£…é …ç›® (Phase 4.2)

**Phase 4.2: CLIå®Ÿè£…** - æœªç€æ‰‹

**ä»•æ§˜ç¢ºèªå®Œäº†** (2025-12-16):
- âœ… å…¨ã‚³ãƒãƒ³ãƒ‰è©³ç´°ä»•æ§˜ä½œæˆ (`spec/architecture/cli-commands.md`)
- âœ… Exit codeã€ã‚°ãƒ­ãƒ¼ãƒãƒ«ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã€ç›£è¦–ã€å¯¾è©±æ©Ÿèƒ½ä»•æ§˜ (`spec/architecture/cli-advanced.md`)
- âœ… CLI-Serverçµ±åˆä»•æ§˜ (`spec/architecture/cli-server-integration.md`)
- âœ… ã‚µãƒ¼ãƒãƒ¼è‡ªå‹•èµ·å‹•è¨­å®šè¿½åŠ  (`spec/architecture/cli.md`)
- âœ… ãƒ•ã‚¡ã‚¤ãƒ«ç›£è¦–ã®ç›®çš„æ˜ç¢ºåŒ–ãƒ»è‡ªå·±æ›¸ãè¾¼ã¿æ¤œçŸ¥ (`spec/features/file-monitoring.md`)
- âœ… ä»•æ§˜å…¨ä½“ã®æ•´åˆæ€§æ¤œè¨¼å®Œäº†

**å®Ÿè£…æº–å‚™**:
- Phase A: åŸºç›¤æ‹¡å¼µï¼ˆconfig, portfile, library hashï¼‰
- Phase B: å‡ºåŠ›ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ï¼ˆjson, pretty, bibtexï¼‰
- Phase C: CLI-Serverçµ±åˆï¼ˆserver-client, server-detectionï¼‰
- Phase D: ã‚³ãƒãƒ³ãƒ‰å®Ÿè£…ï¼ˆlist, search, add, remove, update, serverï¼‰
- Phase E: CLIã‚¨ãƒ³ãƒˆãƒªãƒ¼ï¼ˆcommander setupï¼‰

**è¦‹ç©ã‚‚ã‚Š**: ~155ãƒ†ã‚¹ãƒˆã€19ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ

---

## éç›®æ¨™ (Non-Goals)

ä»¥ä¸‹ã¯ **å®Ÿè£…ã—ãªã„** é …ç›®ã§ã™ (`spec/guidelines/non-goals.md`):

- PDFãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
- ã‚¯ãƒ©ã‚¦ãƒ‰åŒæœŸ
- GUIã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³
- ãƒ–ãƒ©ã‚¦ã‚¶æ‹¡å¼µ
- Zotero/Mendeleyäº’æ›æ€§

---

## å‚ç…§ä»•æ§˜

å®Ÿè£…æ™‚ã¯å¿…ãšä»¥ä¸‹ã®specãƒ•ã‚¡ã‚¤ãƒ«ã‚’å‚ç…§ã—ã¦ãã ã•ã„:

| ã‚«ãƒ†ã‚´ãƒª | ãƒ•ã‚¡ã‚¤ãƒ« | å†…å®¹ |
|---------|---------|------|
| **Core** | `spec/core/overview.md` | ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ¦‚è¦ãƒ»åŸå‰‡ |
| **Core** | `spec/core/data-model.md` | ãƒ‡ãƒ¼ã‚¿ãƒ¢ãƒ‡ãƒ« |
| **Core** | `spec/core/identifier-generation.md` | IDç”Ÿæˆãƒ«ãƒ¼ãƒ« |
| **Architecture** | `spec/architecture/cli.md` | CLIã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã€è¨­å®šãƒ•ã‚¡ã‚¤ãƒ« |
| **Architecture** | `spec/architecture/cli-commands.md` | CLIå…¨ã‚³ãƒãƒ³ãƒ‰è©³ç´°ä»•æ§˜ |
| **Architecture** | `spec/architecture/cli-advanced.md` | Exit codeã€ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã€ç›£è¦–ã€å¯¾è©±æ©Ÿèƒ½ |
| **Architecture** | `spec/architecture/cli-server-integration.md` | CLI-Serverçµ±åˆã€è‡ªå‹•èµ·å‹• |
| **Architecture** | `spec/architecture/http-server.md` | HTTPã‚µãƒ¼ãƒãƒ¼ |
| **Architecture** | `spec/architecture/runtime.md` | ãƒ©ãƒ³ã‚¿ã‚¤ãƒ ãƒ»é…å¸ƒ |
| **Architecture** | `spec/architecture/build-system.md` | ãƒ“ãƒ«ãƒ‰ã‚·ã‚¹ãƒ†ãƒ  |
| **Architecture** | `spec/architecture/directory-structure.md` | ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆ |
| **Features** | `spec/features/metadata.md` | DOI/PMIDç®¡ç† |
| **Features** | `spec/features/duplicate-detection.md` | é‡è¤‡æ¤œå‡º |
| **Features** | `spec/features/search.md` | æ¤œç´¢æ©Ÿèƒ½ |
| **Features** | `spec/features/file-monitoring.md` | ãƒ•ã‚¡ã‚¤ãƒ«ç›£è¦– |
| **Features** | `spec/features/write-safety.md` | æ›¸ãè¾¼ã¿å®‰å…¨æ€§ãƒ»ãƒãƒ¼ã‚¸ |
| **Guidelines** | `spec/guidelines/validation.md` | ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ |
| **Guidelines** | `spec/guidelines/testing.md` | ãƒ†ã‚¹ãƒˆãƒ»å“è³ª |
| **Guidelines** | `spec/guidelines/platform.md` | ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ã‚µãƒãƒ¼ãƒˆ |
| **Guidelines** | `spec/guidelines/pandoc.md` | Pandocäº’æ›æ€§ |

---

## ã¾ã¨ã‚

- **âœ… Phase 1: ã‚³ã‚¢åŸºç›¤ - å®Œäº†** (2025-12-12)
  - âœ… Phase 1.1: CSL-JSONå‡¦ç† (Parser, Serializer, Validator) - 39ãƒ†ã‚¹ãƒˆ
  - âœ… Phase 1.2: è­˜åˆ¥å­ç”Ÿæˆ (Normalizer, Generator, UUID) - 50ãƒ†ã‚¹ãƒˆ
  - âœ… Phase 1.3: ã‚³ã‚¢ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ (Reference, Library) - 51ãƒ†ã‚¹ãƒˆ
  - **å…¨140ãƒ†ã‚¹ãƒˆåˆæ ¼** âœ…

- **âœ… Phase 2: ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ã¨è¨­å®š - å®Œäº†** (2025-12-13)
  - âœ… Phase 2.1: ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«
    - âœ… Logger (ãƒ­ã‚°ãƒ¬ãƒ™ãƒ«ã€stderr/stdoutåˆ†é›¢) - 16ãƒ†ã‚¹ãƒˆ
    - âœ… Hash Utils (SHA-256ãƒãƒƒã‚·ãƒ¥è¨ˆç®—) - 14ãƒ†ã‚¹ãƒˆ
    - âœ… File Utils (atomic writeã€ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªä½œæˆ) - 14ãƒ†ã‚¹ãƒˆ
    - âœ… Backup Utils (ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ç®¡ç†ã€ä¸–ä»£ãƒ»æœŸé™ç®¡ç†) - 16ãƒ†ã‚¹ãƒˆ
  - âœ… Phase 2.2: è¨­å®šç®¡ç†
    - âœ… Config (Zodã‚¹ã‚­ãƒ¼ãƒã€TOMLèª­ã¿è¾¼ã¿ã€è¨­å®šè§£æ±º) - 17ãƒ†ã‚¹ãƒˆ
  - **å…¨77ãƒ†ã‚¹ãƒˆåˆæ ¼** âœ…

- **âœ… Phase 3: æ©Ÿèƒ½ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ« - å®Œäº†** (æœ€çµ‚æ›´æ–°: 2025-12-15)
  - âœ… Phase 3.1: æ¤œç´¢æ©Ÿèƒ½ - å®Œäº† (2025-12-14)
    - âœ… Search Types (å‹å®šç¾©ã€CslItemå‹çµ±ä¸€) - å®Œäº†
    - âœ… Tokenizer (ã‚¯ã‚¨ãƒªãƒˆãƒ¼ã‚¯ãƒ³åŒ–) - 26ãƒ†ã‚¹ãƒˆåˆæ ¼
    - âœ… Normalizer (ãƒ†ã‚­ã‚¹ãƒˆæ­£è¦åŒ–) - 22ãƒ†ã‚¹ãƒˆåˆæ ¼
    - âœ… Matcher (ãƒãƒƒãƒãƒ³ã‚°ã€searché–¢æ•°ã€keywordé…åˆ—) - 31ãƒ†ã‚¹ãƒˆåˆæ ¼
    - âœ… Sorter (çµæœã‚½ãƒ¼ãƒˆã€5æ®µéšã‚½ãƒ¼ãƒˆ) - 16ãƒ†ã‚¹ãƒˆåˆæ ¼
    - âœ… Search Index (ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ) - å®Œäº†
    - **Phase 3.1 å…¨95ãƒ†ã‚¹ãƒˆåˆæ ¼** âœ…
  - âœ… Phase 3.2: é‡è¤‡æ¤œå‡º - å®Œäº† (2025-12-14)
    - âœ… Duplicate Types (å‹å®šç¾©) - å®Œäº†
    - âœ… Detector (DOI â†’ PMID â†’ Title+Author+Year) - 24ãƒ†ã‚¹ãƒˆåˆæ ¼
    - âœ… Duplicate Index (ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ) - å®Œäº†
    - **Phase 3.2 å…¨24ãƒ†ã‚¹ãƒˆåˆæ ¼** âœ…
  - âœ… Phase 3.3: 3-wayãƒãƒ¼ã‚¸ - å®Œäº† (2025-12-15)
    - âœ… Merge Types (å‹å®šç¾©) - å®Œäº†
    - âœ… Three-way Merge (LWWå¯¾å¿œãƒãƒ¼ã‚¸ãƒ­ã‚¸ãƒƒã‚¯) - 21ãƒ†ã‚¹ãƒˆåˆæ ¼
    - âœ… Merge Index (ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ) - å®Œäº†
    - **Phase 3.3 å…¨21ãƒ†ã‚¹ãƒˆåˆæ ¼** âœ…
  - âœ… Phase 3.4: ãƒ•ã‚¡ã‚¤ãƒ«ç›£è¦– - å®Œäº† (2025-12-15)
    - âœ… FileWatcher (chokidarãƒ™ãƒ¼ã‚¹ã€debounceã€ãƒªãƒˆãƒ©ã‚¤) - 26ãƒ†ã‚¹ãƒˆåˆæ ¼
    - âœ… FileWatcher Index (ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ) - å®Œäº†
    - **Phase 3.4 å…¨26ãƒ†ã‚¹ãƒˆåˆæ ¼** âœ…

- **ğŸŸ¢ Phase 4: ã‚µãƒ¼ãƒãƒ¼ã¨CLI** - Phase 4.1 å®Œäº† âœ…ã€Phase 4.2 Aãƒ»Bãƒ»C å®Œäº† âœ…
  - âœ… Phase 4.1: HTTPã‚µãƒ¼ãƒãƒ¼ - å®Œäº† (2025-12-15) - 33ãƒ†ã‚¹ãƒˆåˆæ ¼
  - ğŸŸ  Phase 4.2: CLI - Phase Aãƒ»Bãƒ»C å®Œäº† (2025-12-16)
    - âœ… Phase A: åŸºç›¤æ‹¡å¼µ (config, portfile, library hash) - 67ãƒ†ã‚¹ãƒˆåˆæ ¼
    - âœ… Phase B: å‡ºåŠ›ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ« (json, pretty, bibtex) - 53ãƒ†ã‚¹ãƒˆåˆæ ¼
    - âœ… Phase C: CLI-Serverçµ±åˆ (server-client, server-detection) - 21ãƒ†ã‚¹ãƒˆåˆæ ¼
    - â³ Phase D: ã‚³ãƒãƒ³ãƒ‰å®Ÿè£… - æœªå®Ÿè£…
    - â³ Phase E: CLIã‚¨ãƒ³ãƒˆãƒªãƒ¼ - æœªå®Ÿè£…
    - **Phase 4.2 Aãƒ»Bãƒ»C åˆè¨ˆ**: 141ãƒ†ã‚¹ãƒˆåˆæ ¼
    - **Phase 4.2 D-E è¦‹ç©ã‚‚ã‚Š**: ~14ãƒ†ã‚¹ãƒˆ (Phase D-E ã®ã¿)

- **ğŸ”µ Phase 5: ãƒ“ãƒ«ãƒ‰ãƒ»é…å¸ƒãƒ»CI** - æœªå®Ÿè£…
  - Buildã€CI/CD

**ç·ãƒ†ã‚¹ãƒˆæ•°**: 581ãƒ†ã‚¹ãƒˆåˆæ ¼ (Phase 1: 140, Phase 2: 77, Phase 3: 166, Phase 4.1: 33, Phase 4.2 Aãƒ»Bãƒ»C: 141, ãã®ä»–: 24)

**Phase 4.2 æ®‹ã‚Šè¦‹ç©ã‚‚ã‚Š**: +14ãƒ†ã‚¹ãƒˆ â†’ **ç·è¨ˆ: ~595ãƒ†ã‚¹ãƒˆ**

**ç¾åœ¨ã®ä½œæ¥­**: Phase 4.2 (CLI) - Phase Aãƒ»Bãƒ»C å®Œäº†ã€Phase D é–‹å§‹æº–å‚™ä¸­

**æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—**:
- Phase 4.2 Då®Ÿè£…é–‹å§‹: ã‚³ãƒãƒ³ãƒ‰å®Ÿè£…
  - List Command (`src/cli/commands/list.ts`)
  - Search Command (`src/cli/commands/search.ts`)
  - Add Command (`src/cli/commands/add.ts`)
  - Remove Command (`src/cli/commands/remove.ts`)
  - Update Command (`src/cli/commands/update.ts`)
  - Server Command (`src/cli/commands/server.ts`)
  - Commands Index (`src/cli/commands/index.ts`)
- ãã®å¾Œ Phase E: CLIã‚¨ãƒ³ãƒˆãƒªãƒ¼
